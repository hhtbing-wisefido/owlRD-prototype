# 端口管理和交互式清理说明

## 🎯 概述

为了防止多个服务实例冲突，项目已配置**端口唯一性检查**和**交互式清理功能**。

---

## 📋 端口配置

| 服务 | 端口 | 检查方式 |
|------|------|----------|
| **前端** | 3000 | Node.js脚本 + Vite strictPort |
| **后端** | 8000 | Python内置检查 |

---

## 🚀 启动方式

### 前端启动
```bash
cd frontend
npm run dev
```

**交互流程**：
1. 自动检查3000端口占用
2. 如果端口被占用，显示占用进程信息
3. 询问是否清理占用进程
4. 用户选择 Y/N
5. 清理成功后自动启动Vite

### 后端启动

**推荐方式（带交互检查）**：
```bash
cd backend
python start_with_check.py
```

**内置检查方式**：
```bash
cd backend
python -m app.main
```

**快速启动（跳过检查）**：
```bash
cd backend
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

**交互流程**：
1. 自动检查8000端口占用
2. 如果端口被占用，显示占用进程信息
3. 询问是否清理占用进程
4. 用户选择 Y/N
5. 清理成功后自动启动服务

---

## 💬 交互示例

### 端口被占用时的提示
```
⚠️  端口 8000 被以下进程占用:
  - PID: 12345 | 进程: python.exe
  - PID: 67890 | 进程: uvicorn.exe

是否终止这些进程以启动新的服务? (Y/N): 
```

### 用户选择清理
```
Y
✅ 成功终止进程 PID: 12345
✅ 成功终止进程 PID: 67890
✅ 所有占用进程已清理

✅ 端口 8000 可用，启动服务...
```

### 用户选择不清理
```
N
❌ 用户选择不清理进程，服务无法启动
```

---

## 🛠️ 技术实现

### 前端 (Node.js)
- **文件**: `frontend/check-port.js`
- **命令**: `npm run dev` → 调用端口检查脚本
- **备用**: `npm run dev:direct` → 直接启动Vite（跳过检查）

### 后端 (Python)
- **文件**: `backend/app/main.py`
- **函数**: 
  - `get_port_processes()` - 获取占用进程
  - `kill_processes()` - 清理进程
  - `check_port_available()` - 交互式检查

---

## 🔧 故障排除

### 1. 进程清理失败
**原因**: 权限不足或进程被保护
**解决**: 以管理员身份运行终端

### 2. 端口检查失败
**原因**: netstat命令不可用
**解决**: 确保Windows系统完整安装

### 3. 交互无响应
**原因**: 终端不支持交互输入
**解决**: 使用标准命令行终端（PowerShell/CMD）

---

## 📝 命令速查

| 操作 | 前端命令 | 后端命令 |
|------|----------|----------|
| **标准启动** | `npm run dev` | `python -m app.main` |
| **跳过检查** | `npm run dev:direct` | `python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000` |
| **手动清理** | - | `netstat -ano \| findstr :8000` |

---

## ✅ 优势

1. **防止端口冲突** - 自动检测并处理端口占用
2. **用户友好** - 清晰的提示和选择
3. **安全可控** - 用户确认后才清理进程
4. **详细信息** - 显示占用进程的PID和名称
5. **灵活选择** - 提供跳过检查的备用命令

---

**端口管理功能已完成！现在启动服务时会自动处理端口冲突问题。** 🎉
