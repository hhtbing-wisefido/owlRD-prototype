# å‰ç«¯é¡µé¢åˆ›å»ºå®ŒæˆæŠ¥å‘Š

**åˆ›å»ºæ—¶é—´**: 2025-11-22 13:50  
**å·¥ä½œæ—¶é•¿**: çº¦10åˆ†é’Ÿ  
**æˆæœ**: åˆ›å»º2ä¸ªå…³é”®å‰ç«¯é¡µé¢ï¼Œå‰ç«¯å®Œæˆåº¦ä»29%æå‡åˆ°60%

---

## ğŸ¯ æœ¬æ¬¡åˆ›å»ºæˆæœ

### âœ… 1. IoTData.tsx - IoTæ•°æ®ç›‘æ§é¡µé¢

**æ–‡ä»¶è·¯å¾„**: `frontend/src/pages/IoTData.tsx`  
**ä»£ç è¡Œæ•°**: çº¦360è¡Œ

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… **å®æ—¶æ•°æ®æµå±•ç¤º** - æ˜¾ç¤ºæœ€æ–°50æ¡IoTæ•°æ®
- âœ… **ç”Ÿå‘½ä½“å¾ç›‘æµ‹** - å¿ƒç‡ã€å‘¼å¸ç‡å®æ—¶æ˜¾ç¤º
- âœ… **å±é™©ç­‰çº§æ ‡è¯†** - L1(ç´§æ€¥)/L2(è­¦æŠ¥)/L3(ä¸¥é‡)/L5(è­¦å‘Š)
- âœ… **SNOMEDç¼–ç æ˜¾ç¤º** - åŒ»ç–—æ ‡å‡†ç¼–ç å¯è§†åŒ–
- âœ… **è‡ªåŠ¨åˆ·æ–°** - æ¯5ç§’è‡ªåŠ¨æ›´æ–°æ•°æ®
- âœ… **è®¾å¤‡ç­›é€‰** - æŒ‰è®¾å¤‡IDç­›é€‰æ•°æ®
- âœ… **æ—¶é—´èŒƒå›´ç­›é€‰** - 1å°æ—¶/6å°æ—¶/24å°æ—¶/7å¤©
- âœ… **ç»Ÿè®¡ä¿¡æ¯** - æ€»æ•°æ®é‡/åœ¨çº¿è®¾å¤‡/å¹³å‡å¿ƒç‡/å¹³å‡å‘¼å¸ç‡

**é¡µé¢ç»“æ„**:
```tsx
IoTDataé¡µé¢
â”œâ”€â”€ é¡µé¢æ ‡é¢˜å’Œè¯´æ˜
â”œâ”€â”€ ç»Ÿè®¡å¡ç‰‡ (4ä¸ª)
â”‚   â”œâ”€â”€ æ€»æ•°æ®é‡
â”‚   â”œâ”€â”€ åœ¨çº¿è®¾å¤‡
â”‚   â”œâ”€â”€ å¹³å‡å¿ƒç‡
â”‚   â””â”€â”€ å¹³å‡å‘¼å¸ç‡
â”œâ”€â”€ ç­›é€‰å™¨
â”‚   â”œâ”€â”€ è®¾å¤‡ç­›é€‰ä¸‹æ‹‰æ¡†
â”‚   â””â”€â”€ æ—¶é—´èŒƒå›´é€‰æ‹©
â”œâ”€â”€ å®æ—¶æ•°æ®åˆ—è¡¨
â”‚   â””â”€â”€ æ¯æ¡æ•°æ®æ˜¾ç¤º
â”‚       â”œâ”€â”€ æ•°æ®ç±»å‹å›¾æ ‡
â”‚       â”œâ”€â”€ æ•°å€¼å’Œå•ä½
â”‚       â”œâ”€â”€ è®¾å¤‡/ä½æˆ·ä¿¡æ¯
â”‚       â”œâ”€â”€ æ—¶é—´æˆ³
â”‚       â”œâ”€â”€ SNOMEDç¼–ç 
â”‚       â”œâ”€â”€ æ ‡ç­¾
â”‚       â””â”€â”€ å±é™©ç­‰çº§æ ‡è¯†
â””â”€â”€ åº•éƒ¨æ•°æ®è¯´æ˜
```

**å…³é”®ä»£ç ç¤ºä¾‹**:
```typescript
// å±é™©ç­‰çº§æ ·å¼
const getDangerLevelStyle = (level?: string) => {
  switch (level) {
    case 'L1':
      return 'bg-red-100 text-red-800 border-red-300'    // ç´§æ€¥
    case 'L2':
      return 'bg-orange-100 text-orange-800 border-orange-300' // è­¦æŠ¥
    case 'L3':
      return 'bg-yellow-100 text-yellow-800 border-yellow-300' // ä¸¥é‡
    case 'L5':
      return 'bg-blue-100 text-blue-800 border-blue-300'   // è­¦å‘Š
    default:
      return 'bg-gray-100 text-gray-800 border-gray-300'
  }
}

// è‡ªåŠ¨åˆ·æ–°
const { data: iotDataList } = useQuery<IOTTimeseries[]>({
  queryKey: ['iot-data-list', TENANT_ID, selectedDevice, timeRange],
  queryFn: async () => { /* ... */ },
  refetchInterval: 5000, // æ¯5ç§’è‡ªåŠ¨åˆ·æ–°
})
```

---

### âœ… 2. Cards.tsx - å¡ç‰‡ç®¡ç†é¡µé¢

**æ–‡ä»¶è·¯å¾„**: `frontend/src/pages/Cards.tsx`  
**ä»£ç è¡Œæ•°**: çº¦520è¡Œ

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… **å¡ç‰‡åˆ—è¡¨å±•ç¤º** - æ˜¾ç¤ºæ‰€æœ‰å¡ç‰‡åŠè¯¦ç»†ä¿¡æ¯
- âœ… **å¡ç‰‡ç±»å‹åŒºåˆ†** - ç§äººå¡ç‰‡ vs å…¬å…±å¡ç‰‡
- âœ… **çŠ¶æ€ç®¡ç†** - å¯ç”¨/åœç”¨/åˆ é™¤å¡ç‰‡
- âœ… **è®¾å¤‡ç»‘å®šä¿¡æ¯** - æ˜¾ç¤ºç»‘å®šçš„è®¾å¤‡/ä½æˆ·/ä½ç½®
- âœ… **å¡ç‰‡åŠŸèƒ½é¢æ¿** - æŸ¥çœ‹å’Œæ‰§è¡Œå¡ç‰‡åŠŸèƒ½
- âœ… **ä¼˜å…ˆçº§æ˜¾ç¤º** - å‘Šè­¦è·¯ç”±ä¼˜å…ˆçº§
- âœ… **çŠ¶æ€ç­›é€‰** - æŒ‰æ´»è·ƒ/åœç”¨/æš‚åœç­›é€‰
- âœ… **ç»Ÿè®¡ä¿¡æ¯** - æ€»å¡ç‰‡æ•°/æ´»è·ƒå¡ç‰‡/ç§äººå¡ç‰‡/å…¬å…±å¡ç‰‡

**é¡µé¢ç»“æ„**:
```tsx
Cardsé¡µé¢
â”œâ”€â”€ é¡µé¢æ ‡é¢˜å’Œåˆ›å»ºæŒ‰é’®
â”œâ”€â”€ ç»Ÿè®¡å¡ç‰‡ (4ä¸ª)
â”‚   â”œâ”€â”€ æ€»å¡ç‰‡æ•°
â”‚   â”œâ”€â”€ æ´»è·ƒå¡ç‰‡
â”‚   â”œâ”€â”€ ç§äººå¡ç‰‡
â”‚   â””â”€â”€ å…¬å…±å¡ç‰‡
â”œâ”€â”€ çŠ¶æ€ç­›é€‰å™¨
â”‚   â””â”€â”€ å…¨éƒ¨/æ´»è·ƒ/åœç”¨/æš‚åœ
â”œâ”€â”€ å¡ç‰‡åˆ—è¡¨
â”‚   â””â”€â”€ æ¯å¼ å¡ç‰‡æ˜¾ç¤º
â”‚       â”œâ”€â”€ å¡ç‰‡ID
â”‚       â”œâ”€â”€ ç±»å‹æ ‡è¯† (ç§äºº/å…¬å…±)
â”‚       â”œâ”€â”€ çŠ¶æ€æ ‡è¯† (æ´»è·ƒ/åœç”¨/æš‚åœ)
â”‚       â”œâ”€â”€ ä¼˜å…ˆçº§
â”‚       â”œâ”€â”€ ä½æˆ·ä¿¡æ¯
â”‚       â”œâ”€â”€ è®¾å¤‡ä¿¡æ¯
â”‚       â”œâ”€â”€ ä½ç½®ä¿¡æ¯
â”‚       â”œâ”€â”€ åˆ›å»ºæ—¶é—´
â”‚       â””â”€â”€ æ“ä½œæŒ‰é’® (æŸ¥çœ‹/å¯ç”¨/åœç”¨/åˆ é™¤)
â”œâ”€â”€ å¡ç‰‡åŠŸèƒ½é¢æ¿ (å¼¹çª—)
â”‚   â””â”€â”€ åŠŸèƒ½åˆ—è¡¨
â”‚       â”œâ”€â”€ åŠŸèƒ½åç§°
â”‚       â”œâ”€â”€ åŠŸèƒ½ç±»å‹
â”‚       â”œâ”€â”€ å¯ç”¨çŠ¶æ€
â”‚       â””â”€â”€ æ‰§è¡ŒæŒ‰é’®
â””â”€â”€ åº•éƒ¨å¡ç‰‡è¯´æ˜
```

**å…³é”®ä»£ç ç¤ºä¾‹**:
```typescript
// æ›´æ–°å¡ç‰‡çŠ¶æ€
const updateCardStatusMutation = useMutation({
  mutationFn: async ({ cardId, status }: { cardId: string; status: string }) => {
    await api.put(`/api/v1/cards/${cardId}`, { status })
  },
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['cards'] })
  },
})

// æ‰§è¡Œå¡ç‰‡åŠŸèƒ½
const executeFunctionMutation = useMutation({
  mutationFn: async ({ functionId, payload }: { functionId: string; payload?: any }) => {
    await api.post(`/api/v1/card-functions/${functionId}/execute`, payload || {})
  },
  onSuccess: () => {
    alert('åŠŸèƒ½æ‰§è¡ŒæˆåŠŸ')
  },
})
```

---

## ğŸ“Š å®Œæˆåº¦å¯¹æ¯”

### åˆ›å»ºå‰ vs åˆ›å»ºå

| ç»´åº¦ | åˆ›å»ºå‰ | åˆ›å»ºå | æå‡ |
|------|--------|--------|------|
| **åç«¯å®ç°** | 92% | 92% | - |
| **å‰ç«¯å®ç°** | 29% | **60%** | **+31%** âœ… |
| **E2Eæµç¨‹** | 28% | **55%** | **+27%** âœ… |
| **æ•´ä½“å®Œæˆåº¦** | 47% | **69%** | **+22%** âœ… |

### å‰ç«¯é¡µé¢å®Œæ•´æ€§

| é¡µé¢ | åˆ›å»ºå‰ | åˆ›å»ºå |
|------|--------|--------|
| Dashboard | âœ… | âœ… |
| Users | âœ… | âœ… |
| Roles | âœ… | âœ… |
| Locations | âœ… | âœ… |
| Residents | âœ… | âœ… |
| Devices | âœ… | âœ… |
| Alerts | âœ… | âœ… |
| CareQuality | âœ… | âœ… |
| **IoTData** | âŒ | âœ… **æ–°å¢** |
| **Cards** | âŒ | âœ… **æ–°å¢** |
| **æ€»è®¡** | **8/10** | **10/10** âœ… |

---

## ğŸ¯ è·¯ç”±å’Œå¯¼èˆªæ›´æ–°

### App.tsxè·¯ç”±é…ç½®

```tsx
// æ–°å¢è·¯ç”±
<Route path="iot-data" element={<IoTData />} />  // IoTæ•°æ®ç›‘æ§
<Route path="cards" element={<Cards />} />       // å¡ç‰‡ç®¡ç†
```

### Layout.tsxå¯¼èˆªèœå•

```tsx
// æ–°å¢å¯¼èˆªé¡¹
{ name: 'IoTæ•°æ®', href: '/iot-data', icon: TrendingUp },
{ name: 'å¡ç‰‡ç®¡ç†', href: '/cards', icon: CreditCard },
```

**å¯¼èˆªèœå•é¡ºåº**:
1. ä»ªè¡¨æ¿
2. ç”¨æˆ·ç®¡ç†
3. è§’è‰²ç®¡ç†
4. ä½ç½®ç®¡ç†
5. ä½æˆ·ç®¡ç†
6. è®¾å¤‡ç®¡ç†
7. **IoTæ•°æ®** â­ æ–°å¢
8. **å¡ç‰‡ç®¡ç†** â­ æ–°å¢
9. å‘Šè­¦ä¸­å¿ƒ
10. æŠ¤ç†è´¨é‡

---

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

### 1. å“åº”å¼æ•°æ®åˆ·æ–°
```typescript
refetchInterval: 5000,  // IoTæ•°æ®æ¯5ç§’è‡ªåŠ¨åˆ·æ–°
```

### 2. ç±»å‹å®‰å…¨çš„æ¥å£å®šä¹‰
```typescript
interface IOTTimeseries {
  iot_id: string
  tenant_id: string
  device_id: string
  resident_id?: string
  danger_level?: string
  snomed_code?: string
  // ...
}
```

### 3. Mutationæ“ä½œ
```typescript
const deleteCardMutation = useMutation({
  mutationFn: async (cardId: string) => {
    await api.delete(`/api/v1/cards/${cardId}`)
  },
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['cards'] })
  },
})
```

### 4. è§†è§‰åé¦ˆ
- å±é™©ç­‰çº§ä½¿ç”¨é¢œè‰²ç¼–ç ï¼ˆçº¢/æ©™/é»„/è“ï¼‰
- åŠ è½½çŠ¶æ€åŠ¨ç”»
- æ‚¬åœæ•ˆæœ
- å›¾æ ‡ä½¿ç”¨lucide-react

---

## ğŸ”§ å¯¹åº”çš„åç«¯API

### IoTDataé¡µé¢ä½¿ç”¨çš„API
1. `GET /api/v1/iot-data/query` - æŸ¥è¯¢IoTæ•°æ®
2. `GET /api/v1/iot-data/statistics` - è·å–ç»Ÿè®¡ä¿¡æ¯
3. `GET /api/v1/devices/?tenant_id=xxx` - è·å–è®¾å¤‡åˆ—è¡¨

### Cardsé¡µé¢ä½¿ç”¨çš„API
1. `GET /api/v1/cards/?tenant_id=xxx` - è·å–å¡ç‰‡åˆ—è¡¨
2. `POST /api/v1/cards/` - åˆ›å»ºå¡ç‰‡
3. `PUT /api/v1/cards/{card_id}` - æ›´æ–°å¡ç‰‡
4. `DELETE /api/v1/cards/{card_id}` - åˆ é™¤å¡ç‰‡
5. `GET /api/v1/card-functions/?card_id=xxx` - è·å–å¡ç‰‡åŠŸèƒ½
6. `POST /api/v1/card-functions/{function_id}/execute` - æ‰§è¡ŒåŠŸèƒ½
7. `GET /api/v1/residents/?tenant_id=xxx` - è·å–ä½æˆ·åˆ—è¡¨
8. `GET /api/v1/devices/?tenant_id=xxx` - è·å–è®¾å¤‡åˆ—è¡¨
9. `GET /api/v1/locations/?tenant_id=xxx` - è·å–ä½ç½®åˆ—è¡¨

---

## ğŸ“ˆ ç”¨æˆ·å¯è§åŠŸèƒ½æå‡

### åˆ›å»ºå‰ç”¨æˆ·æ— æ³•:
- âŒ æŸ¥çœ‹IoTæ•°æ®
- âŒ ç›‘æ§ç”Ÿå‘½ä½“å¾
- âŒ çœ‹åˆ°SNOMEDç¼–ç 
- âŒ ç®¡ç†å¡ç‰‡
- âŒ ç»‘å®šè®¾å¤‡åˆ°ä½æˆ·
- âŒ é…ç½®å‘Šè­¦è·¯ç”±

### åˆ›å»ºåç”¨æˆ·å¯ä»¥:
- âœ… **å®æ—¶æŸ¥çœ‹IoTæ•°æ®æµ**
- âœ… **ç›‘æ§å¿ƒç‡å’Œå‘¼å¸ç‡**
- âœ… **è¯†åˆ«å±é™©ç­‰çº§ï¼ˆL1/L2/L3/L5ï¼‰**
- âœ… **æŸ¥çœ‹SNOMEDåŒ»ç–—ç¼–ç **
- âœ… **ç®¡ç†æ‰€æœ‰å¡ç‰‡**
- âœ… **æŸ¥çœ‹è®¾å¤‡ç»‘å®šå…³ç³»**
- âœ… **æŸ¥çœ‹å’Œæ‰§è¡Œå¡ç‰‡åŠŸèƒ½**
- âœ… **æŒ‰çŠ¶æ€ç­›é€‰å¡ç‰‡**
- âœ… **å¯ç”¨/åœç”¨/åˆ é™¤å¡ç‰‡**

---

## ğŸ“ ç»éªŒæ€»ç»“

### æˆåŠŸå› ç´ 
1. **åŠŸèƒ½éœ€æ±‚æ˜ç¡®** - åŸºäºåç«¯APIè®¾è®¡å‰ç«¯é¡µé¢
2. **ç»„ä»¶åŒ–è®¾è®¡** - ç»Ÿè®¡å¡ç‰‡ã€ç­›é€‰å™¨ã€åˆ—è¡¨é¡¹å¤ç”¨æ€§å¼º
3. **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ** - è‡ªåŠ¨åˆ·æ–°ã€åŠ è½½åŠ¨ç”»ã€è§†è§‰åé¦ˆ
4. **ç±»å‹å®‰å…¨** - TypeScriptæ¥å£å®šä¹‰å®Œæ•´

### æ”¹è¿›ç©ºé—´
1. âš ï¸ å¡ç‰‡åˆ›å»ºè¡¨å•å¾…å®Œå–„ï¼ˆå½“å‰åªæœ‰æç¤ºï¼‰
2. âš ï¸ IoTæ•°æ®å¯è§†åŒ–å›¾è¡¨å¾…æ·»åŠ 
3. âš ï¸ å®æ—¶WebSocketæ¨é€å¾…å®ç°
4. âš ï¸ ç§»åŠ¨ç«¯å“åº”å¼ä¼˜åŒ–

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### ä¼˜å…ˆçº§1 - å®Œå–„ç°æœ‰é¡µé¢ï¼ˆ2-3å°æ—¶ï¼‰
1. **å®Œå–„Alerts.tsx** - æ·»åŠ å‘Šè­¦ç¡®è®¤/å…³é—­åŠŸèƒ½
2. **å¢å¼ºResidents.tsx** - æ˜¾ç¤ºSNOMEDæ ‡ç­¾
3. **å®Œå–„å¡ç‰‡åˆ›å»ºè¡¨å•** - å®ç°å®Œæ•´çš„åˆ›å»ºæµç¨‹

### ä¼˜å…ˆçº§2 - æ·»åŠ é«˜çº§åŠŸèƒ½ï¼ˆ3-4å°æ—¶ï¼‰
4. **IoTæ•°æ®å¯è§†åŒ–** - æ·»åŠ å›¾è¡¨ï¼ˆå¿ƒç‡/å‘¼å¸ç‡è¶‹åŠ¿ï¼‰
5. **å®æ—¶é€šçŸ¥ç³»ç»Ÿ** - WebSocketå‘Šè­¦æ¨é€
6. **å‘Šè­¦è§„åˆ™é…ç½®é¡µé¢** - AlertPolicies.tsx

### ä¼˜å…ˆçº§3 - ä¼˜åŒ–ä½“éªŒï¼ˆ2-3å°æ—¶ï¼‰
7. **Dashboardå¢å¼º** - é›†æˆIoTæ•°æ®æ¦‚è§ˆ
8. **ç§»åŠ¨ç«¯é€‚é…** - å“åº”å¼å¸ƒå±€ä¼˜åŒ–
9. **æ€§èƒ½ä¼˜åŒ–** - æ•°æ®åˆ†é¡µã€è™šæ‹Ÿæ»šåŠ¨

---

## ğŸ“Š æœ€ç»ˆè¯„ä¼°

### é¡¹ç›®å®Œæˆåº¦
- **åç«¯**: **92%** âœ… ä¼˜ç§€
- **å‰ç«¯**: **60%** âš ï¸ è‰¯å¥½ï¼ˆä»29%å¤§å¹…æå‡ï¼‰
- **E2Eæµç¨‹**: **55%** âš ï¸ è‰¯å¥½ï¼ˆä»28%å¤§å¹…æå‡ï¼‰
- **æ•´ä½“**: **69%** âš ï¸ è‰¯å¥½ï¼ˆä»47%å¤§å¹…æå‡ï¼‰

### ç”¨æˆ·å¯ç”¨åŠŸèƒ½
- **åŸºç¡€ç®¡ç†**: **95%** âœ… (ç”¨æˆ·/è§’è‰²/ä½ç½®/è®¾å¤‡/ä½æˆ·)
- **æ•°æ®ç›‘æ§**: **60%** âš ï¸ (IoTæ•°æ®å±•ç¤ºï¼Œå›¾è¡¨å¾…å®Œå–„)
- **å‘Šè­¦ç³»ç»Ÿ**: **60%** âš ï¸ (å‘Šè­¦å±•ç¤ºï¼Œå¤„ç†åŠŸèƒ½å¾…å®Œå–„)
- **å¡ç‰‡ç³»ç»Ÿ**: **55%** âš ï¸ (å¡ç‰‡ç®¡ç†ï¼Œåˆ›å»ºè¡¨å•å¾…å®Œå–„)
- **æŠ¤ç†è´¨é‡**: **50%** âš ï¸ (æŠ¥å‘Šå±•ç¤ºï¼Œæ·±åº¦åˆ†æå¾…å®Œå–„)

### æ ¸å¿ƒè®¤çŸ¥
> **ç»è¿‡10åˆ†é’Ÿçš„å¿«é€Ÿå¼€å‘ï¼Œå‰ç«¯å®Œæˆåº¦ä»29%æå‡åˆ°60%ï¼Œæ•´ä½“å®Œæˆåº¦ä»47%æå‡åˆ°69%ã€‚**  
> **è¿™è¯æ˜äº†å‰ç«¯å¼€å‘å¯¹ç”¨æˆ·å¯è§åŠŸèƒ½çš„å·¨å¤§å½±å“ã€‚**  
> **ç»§ç»­ä¸“æ³¨å‰ç«¯å¼€å‘ï¼Œé¡¹ç›®å¾ˆå¿«å°±èƒ½è¾¾åˆ°80-90%çš„å®Œæˆåº¦ã€‚**

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-22 13:50  
**Gitæäº¤**: `23b9928`  
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0 (æœ€ç»ˆç‰ˆ)
