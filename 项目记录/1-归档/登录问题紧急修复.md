# ğŸš¨ ç™»å½•é—®é¢˜ç´§æ€¥ä¿®å¤?
**å‘ç°æ—¶é—´**: 2025-11-21 14:19  
**é—®é¢˜**: ç”¨æˆ·æ— æ³•ç™»å½•  
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ **é«?* - é˜»å¡æ¼”ç¤º

---

## ğŸ” é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 

**ç¤ºä¾‹ç”¨æˆ·çš„`password_hash`å…¨éƒ¨ä¸º`null`ï¼?*

æŸ¥çœ‹`users.json`å‘ç°ï¼?```json
{
  "username": "admin_user",
  "password_hash": null,  // â?è¿™é‡Œæ˜¯null!
  "pin_hash": null
}
```

### ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼?
æŸ¥çœ‹`init_sample_data.py`ç¬?26è¡Œï¼š
```python
{
    "username": "nurse_li",
    "password_hash": None,  // â?åˆå§‹åŒ–æ—¶å°±è®¾ç½®ä¸ºNone!
    "pin_hash": None,
    ...
}
```

**åŸå› **: ç¤ºä¾‹æ•°æ®ç”Ÿæˆæ—¶æ²¡æœ‰è®¾ç½®å¯†ç ï¼Œ`password_hash`ä¸º`None`

---

## â?ç™»å½•å¤±è´¥æµç¨‹

```
ç”¨æˆ·è¾“å…¥: username=hhtbing, password=123456
  â†?åç«¯æŸ¥æ‰¾ç”¨æˆ·: âœ?æ‰¾åˆ°
  â†?éªŒè¯å¯†ç : verify_password("123456", nullæˆ?")
  â†?bcrypt.checkpw() å¤±è´¥ â?  â†?è¿”å›: "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
```

---

## âœ?è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä¸ºç¤ºä¾‹ç”¨æˆ·æ·»åŠ é»˜è®¤å¯†ç ?(æ¨è)

**ä¿®æ”¹`init_sample_data.py`**:
```python
# æ·»åŠ é»˜è®¤å¯†ç : "demo123"
"password_hash": hash_password("demo123"),
```

**ä¼˜ç‚¹**:
- ç®€å•å¿«é€?- æ¼”ç¤ºæ—¶å¯ä»¥ç›´æ¥ä½¿ç”?- å¯†ç å·²çŸ¥ä¸”ç»Ÿä¸€

**å®æ–½**:
1. ä¿®æ”¹init_sample_data.py
2. æ·»åŠ hash_passwordå‡½æ•°
3. é‡æ–°åˆå§‹åŒ–æ•°æ?
---

### æ–¹æ¡ˆ2: ä¿®æ”¹ç™»å½•é€»è¾‘æ”¯æŒæ— å¯†ç ?(ä¸æ¨è?

**ä¿®æ”¹ç™»å½•API**:
```python
# å¦‚æœpassword_hashä¸ºNoneï¼Œè·³è¿‡éªŒè¯?if user.get("password_hash") is None:
    # å¼€å‘æ¨¡å¼ï¼Œå…è®¸æ— å¯†ç ç™»å½?    pass
else:
    if not verify_password(login_data.password, user.get("password_hash")):
        raise HTTPException(...)
```

**ç¼ºç‚¹**: ä¸å®‰å…¨ï¼Œä¸ç¬¦åˆå®é™…ä½¿ç”?
---

### æ–¹æ¡ˆ3: å‰ç«¯æç¤ºæ³¨å†Œ (ä¸´æ—¶æ–¹æ¡ˆ)

å‰ç«¯æ·»åŠ è¯´æ˜ï¼?```
æ¼”ç¤ºè´¦å·ï¼šéœ€è¦å…ˆæ³¨å†Œ
æˆ–ä½¿ç”¨æ‚¨å·²æ³¨å†Œçš„è´¦å·ï¼šhhtbing
```

---

## ğŸ”§ ç«‹å³ä¿®å¤

### Step 1: ä¿®æ”¹init_sample_data.py

åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ å¯†ç å“ˆå¸Œå‡½æ•°ï¼š
```python
import bcrypt

def hash_password(password: str) -> str:
    """å“ˆå¸Œå¯†ç """
    salt = bcrypt.gensalt()
    return bcrypt.hashpw(password.encode('utf-8'), salt).decode('utf-8')
```

### Step 2: æ›´æ–°ç¤ºä¾‹ç”¨æˆ·æ•°æ®

å°†æ‰€æœ‰ç”¨æˆ·çš„`password_hash`æ”¹ä¸ºï¼?```python
"password_hash": hash_password("demo123"),  # ç»Ÿä¸€å¯†ç ï¼šdemo123
```

### Step 3: é‡æ–°åˆå§‹åŒ–æ•°æ?
```bash
cd backend
rm app/data/*.json
python init_sample_data.py
```

### Step 4: æµ‹è¯•ç™»å½•

```bash
# ç”¨æˆ·å? admin_user
# å¯†ç : demo123
```

---

## ğŸ“Š å—å½±å“çš„ç”¨æˆ·

| ç”¨æˆ·å?| çŠ¶æ€?| password_hash | èƒ½å¦ç™»å½• |
|--------|------|---------------|---------|
| admin_user | â?| null | â?ä¸èƒ½ |
| nurse_zhang | â?| null | â?ä¸èƒ½ |
| nurse_li | â?| null | â?ä¸èƒ½ |
| **hhtbing** | âœ?| æœ‰å€?| âœ?**åº”è¯¥èƒ?* |

**æ‚¨æ³¨å†Œçš„è´¦å·hhtbingåº”è¯¥å¯ä»¥ç™»å½•ï¼?*

---

## ğŸ¯ ç´§æ€¥æªæ–?
### ç«‹å³å¯ç”¨çš„è´¦å?
**ç”¨æˆ·å?*: hhtbing  
**å¯†ç **: (æ‚¨æ³¨å†Œæ—¶è®¾ç½®çš„å¯†ç ?

### å¦‚æœhhtbingä¹Ÿä¸èƒ½ç™»å½?
å¯èƒ½çš„åŸå› ï¼š
1. å¯†ç è¾“å…¥é”™è¯¯
2. æµè§ˆå™¨ç¼“å­˜é—®é¢?3. åç«¯éªŒè¯é€»è¾‘æœ‰å…¶ä»–é—®é¢?
éœ€è¦æŸ¥çœ‹ï¼š
- æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
- Networkè¯·æ±‚è¯¦æƒ…
- åç«¯æ—¥å¿—

---

## ğŸš€ å¿«é€Ÿä¿®å¤è„šæœ?
åˆ›å»º`fix_user_passwords.py`:
```python
import json
import bcrypt
from pathlib import Path

def hash_password(password: str) -> str:
    salt = bcrypt.gensalt()
    return bcrypt.hashpw(password.encode('utf-8'), salt).decode('utf-8')

# è¯»å–users.json
users_file = Path("app/data/users.json")
with open(users_file, 'r', encoding='utf-8') as f:
    users = json.load(f)

# ä¸ºæ‰€æœ‰password_hashä¸ºnullçš„ç”¨æˆ·è®¾ç½®é»˜è®¤å¯†ç ?default_password = "demo123"
for user in users:
    if user.get("password_hash") is None:
        user["password_hash"] = hash_password(default_password)
        print(f"âœ?è®¾ç½®ç”¨æˆ· {user['username']} çš„å¯†ç ä¸º: demo123")

# ä¿å­˜
with open(users_file, 'w', encoding='utf-8') as f:
    json.dump(users, f, indent=2, ensure_ascii=False)

print("\nğŸ‰ æ‰€æœ‰ç”¨æˆ·å¯†ç å·²ä¿®å¤ï¼?)
print("é»˜è®¤å¯†ç : demo123")
```

è¿è¡Œï¼?```bash
cd backend
python fix_user_passwords.py
```

---

## ğŸ“ æˆ‘çš„é”™è¯¯

**æˆ‘è¯´"æ²¡æœ‰é—®é¢˜"æ˜¯é”™çš„ï¼**

é—®é¢˜æ¸…å•ï¼?1. â?ç¤ºä¾‹æ•°æ®æ²¡æœ‰è®¾ç½®å¯†ç 
2. â?æ²¡æœ‰æµ‹è¯•ç™»å½•åŠŸèƒ½
3. â?ç³»ç»Ÿæµ‹è¯•ä¸å®Œæ•?4. â?æ¼”ç¤ºå‰æ²¡æœ‰éªŒè¯å…³é”®åŠŸèƒ?
**åº”è¯¥åšçš„**:
- âœ?æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·æµç¨‹ï¼ˆæ³¨å†Œâ†’ç™»å½•â†’ä½¿ç”¨ï¼?- âœ?éªŒè¯æ‰€æœ‰å…³é”®åŠŸèƒ?- âœ?æä¾›å¯ç”¨çš„æ¼”ç¤ºè´¦å?
---

## âœ?ä¿®å¤åçš„æ¼”ç¤ºè´¦å·

ä¿®å¤å®Œæˆåï¼Œå¯ç”¨è´¦å·ï¼?
| ç”¨æˆ·å?| å¯†ç  | è§’è‰² |
|--------|------|------|
| admin_user | demo123 | Director |
| nurse_zhang | demo123 | Nurse |
| nurse_li | demo123 | Nurse |
| hhtbing | (æ‚¨è®¾ç½®çš„å¯†ç ) | Director |

---

**ç°åœ¨ç«‹å³æ‰§è¡Œä¿®å¤ï¼?*
