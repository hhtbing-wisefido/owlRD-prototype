# ç¤ºä¾‹æ•°æ®è„šæœ¬æ›´æ–°è¯´æ˜

**æ›´æ–°æ—¶é—´**: 2025-11-20 20:06  
**æ›´æ–°ç›®çš„**: ä¸¥æ ¼å¯¹é½æºå‚è€ƒæ–‡ä»¶çš„è¡¨ç»“æ„

---

## ğŸ“Š æ›´æ–°å¯¹æ¯”

### ä¹‹å‰ç‰ˆæœ¬ (æ¼”ç¤ºç®€åŒ–ç‰ˆ)
- ç›®çš„ï¼šå¿«é€Ÿæ¼”ç¤º
- ç‰¹ç‚¹ï¼šå­—æ®µç®€åŒ–ï¼Œè”ç³»äººä¿¡æ¯åˆå¹¶

### å½“å‰ç‰ˆæœ¬ (æºå‚è€ƒå¯¹é½ç‰ˆ) âœ…
- ç›®çš„ï¼šå®Œå…¨æŒ‰ç…§æºå‚è€ƒSQL schemaç”Ÿæˆæ•°æ®
- ç‰¹ç‚¹ï¼šå­—æ®µå®Œæ•´ï¼Œè¡¨ç»“æ„è§„èŒƒ

---

## ğŸ”„ ä¸»è¦æ›´æ–°å†…å®¹

### 1. **Tenants (ç§Ÿæˆ·è¡¨)**

#### ä¹‹å‰
```python
{
    "tenant_name": "ç¤ºä¾‹å…»è€é™¢",
    "tenant_code": "DEMO001",  # æ‰©å±•å­—æ®µ
    "contact_email": "...",     # æ‰©å±•å­—æ®µ
    "license_type": "...",      # æ‰©å±•å­—æ®µ
    # ... æ›´å¤šæ‰©å±•å­—æ®µ
}
```

#### ç°åœ¨ (å¯¹é½01_tenants.sql)
```python
{
    "tenant_name": "ç¤ºä¾‹å…»è€é™¢",
    "domain": "demo-facility.owlrd.com",  # æ ‡å‡†å­—æ®µ
    "status": "active",                    # æ ‡å‡†å­—æ®µ
    "metadata": {                          # æ‰©å±•ä¿¡æ¯ç»Ÿä¸€æ”¾è¿™é‡Œ
        "license_type": "ENTERPRISE",
        "contact_email": "..."
    }
}
```

**æ”¹è¿›**: âœ… ç¬¦åˆæºå‚è€ƒçš„åŸºç¡€å­—æ®µè®¾è®¡ï¼Œæ‰©å±•ä¿¡æ¯æ”¾åœ¨metadataä¸­

---

### 2. **Users (ç”¨æˆ·è¡¨)**

#### ä¹‹å‰
```python
{
    "username": "admin",
    "full_name": "ç®¡ç†å‘˜",  # éæ ‡å‡†å­—æ®µ
    "email": "admin@demo.com",
    "phone": "+86-138-0000-0001",
    "role": "ADMIN",
    "department": "ç®¡ç†éƒ¨",  # éæ ‡å‡†å­—æ®µ
}
```

#### ç°åœ¨ (å¯¹é½03_users.sql)
```python
{
    "username": "admin_user",
    "email": "admin@demo.com",
    "phone": "+86-138-0000-0001",
    "email_hash": hash_contact("admin@demo.com"),  # âœ… æ–°å¢å“ˆå¸Œ
    "phone_hash": hash_contact("+86-138-0000-0001"), # âœ… æ–°å¢å“ˆå¸Œ
    "password_hash": None,
    "pin_hash": None,
    "role": "Director",  # âœ… æ ‡å‡†è§’è‰²å
    "status": "active",
    "alert_levels": ["L1", "L2", "L3"],  # âœ… æ–°å¢å‘Šè­¦é…ç½®
    "alert_channels": ["APP", "EMAIL"],   # âœ… æ–°å¢é€šé“é…ç½®
    "alert_scope": "ALL",                 # âœ… æ–°å¢èŒƒå›´é…ç½®
    "tags": {"department": "ç®¡ç†éƒ¨"},      # âœ… æ ‡ç­¾åŒ–
}
```

**æ”¹è¿›**: 
- âœ… æ·»åŠ SHA-256å“ˆå¸Œå­—æ®µ
- âœ… æ·»åŠ å‘Šè­¦æ¥æ”¶é…ç½®
- âœ… ä½¿ç”¨æ ‡å‡†è§’è‰²å
- âœ… å±æ€§æ ‡ç­¾åŒ–

---

### 3. **Residents (ä½æˆ·è¡¨)** â­ æ ¸å¿ƒæ›´æ–°

#### ä¹‹å‰
```python
{
    "resident_account": "R001",
    "last_name": "ç‹è€å…ˆç”Ÿ",
    "anonymous_name": "æ´»åŠ›è€äºº",
    "location_id": "...",
    "bed_id": "...",
    # âŒ è”ç³»äººä¿¡æ¯ç›´æ¥å­˜å‚¨
    "primary_contact_name": "ç‹å°æ˜",
    "primary_contact_phone": "+86-138-1111-1111",
    "primary_contact_relation": "å„¿å­",
}
```

#### ç°åœ¨ (å¯¹é½07_residents.sql)
```python
{
    # âœ… HISç³»ç»Ÿé›†æˆå­—æ®µ
    "HIS_resident_id": "HIS-R-2023-001",
    "HIS_resident_bed_id": "HIS-BED-101-1",
    "HIS_resident_status": "active",
    
    "resident_account": "R001",
    "first_name": None,
    "last_name": "æ´»åŠ›è€äºº",  # è™šæ‹Ÿå§“å
    "anonymous_name": "æ´»åŠ›è€äºº",
    
    "location_id": "...",
    "bed_id": "...",
    "admission_date": "...",
    "status": "active",
    "metadata": {"notes": "æ¼”ç¤ºä½æˆ·1"},  # éPIIä¿¡æ¯
    
    # âœ… å“ˆå¸Œå­˜å‚¨ï¼ˆä¸å­˜æ˜æ–‡ï¼‰
    "phone_hash": hash_contact("+86-138-1111-1111"),
    "email_hash": hash_contact("resident001@example.com"),
    
    # âœ… å®¶åº­æ ‡ç­¾
    "family_tag": "FAMILY-WANG",
    "family_member_account_1": None,
    
    "can_view_status": True,
}
```

**æ”¹è¿›**: 
- âœ… æ·»åŠ HISç³»ç»Ÿé›†æˆå­—æ®µ
- âœ… ä½¿ç”¨å“ˆå¸Œå­˜å‚¨è”ç³»æ–¹å¼ï¼ˆä¸å­˜æ˜æ–‡ï¼‰
- âœ… æ·»åŠ å®¶åº­æ ‡ç­¾åŠŸèƒ½
- âŒ ç§»é™¤è”ç³»äººä¿¡æ¯ï¼ˆç§»åˆ°ç‹¬ç«‹è¡¨ï¼‰

---

### 4. **Resident_Contacts (ä½æˆ·è”ç³»äººè¡¨)** âœ¨ æ–°å¢

#### ä¹‹å‰
âŒ ä¸å­˜åœ¨ç‹¬ç«‹çš„è”ç³»äººè¡¨

#### ç°åœ¨ (å¯¹é½09_resident_contacts.sql)
```python
{
    "contact_id": "...",
    "tenant_id": "...",
    "resident_id": "...",
    "slot": "A",  # A/B/C/D/E æ§½ä½
    "contact_resident_id": None,  # å¯æŒ‡å‘å¦ä¸€ä¸ªresidentsè®°å½•
    
    # æƒé™è®¾ç½®
    "can_view_status": True,
    "can_receive_alert": True,
    "relationship": "Child",
    
    # å¯é€‰çš„PHIï¼ˆä»…ç‰¹å®šåœºæ™¯å¡«å†™ï¼‰
    "contact_first_name": "å°æ˜",
    "contact_last_name": "ç‹",
    "contact_phone": "+86-138-1111-1111",
    "contact_email": "wangxiaoming@example.com",
    "contact_sms": True,
    
    # å“ˆå¸Œå­˜å‚¨
    "phone_hash": hash_contact("+86-138-1111-1111"),
    "email_hash": hash_contact("wangxiaoming@example.com"),
    
    "is_active": True,
}
```

**æ”¹è¿›**: 
- âœ… ç‹¬ç«‹çš„è”ç³»äººè¡¨ï¼Œç¬¦åˆæ•°æ®è§„èŒƒåŒ–
- âœ… æ”¯æŒæ§½ä½ç®¡ç†(A/B/C/D/E)
- âœ… çµæ´»çš„æƒé™æ§åˆ¶
- âœ… å“ˆå¸Œå­˜å‚¨å¢å¼ºå®‰å…¨æ€§

---

### 5. **Resident_Caregivers (æŠ¤ç†äººå‘˜å…³è”è¡¨)** âœ¨ æ–°å¢

#### ä¹‹å‰
âŒ ä¸å­˜åœ¨ç‹¬ç«‹çš„æŠ¤ç†äººå‘˜å…³è”è¡¨

#### ç°åœ¨ (å¯¹é½10_resident_caregivers.sql)
```python
{
    "id": "...",
    "tenant_id": "...",
    "resident_id": "...",
    
    # 5ä¸ªæŠ¤ç†äººå‘˜IDï¼ˆæºå‚è€ƒè¦æ±‚éƒ½æ˜¯å¿…å¡«ï¼‰
    "caregiver_id1": "user_id_1",  # æŠ¤å£«å¼ ä¸‰
    "caregiver_id2": "user_id_2",  # æŠ¤å£«æå››
    "caregiver_id3": "user_id_1",  # å¯é‡å¤
    "caregiver_id4": "user_id_1",
    "caregiver_id5": "user_id_1",
    
    # æŠ¤å£«ç»„æ ‡ç­¾
    "nurse_group_tags": ["Aç»„", "DayShift", "FallsExpert"],
}
```

**æ”¹è¿›**: 
- âœ… ç‹¬ç«‹çš„å…³è”è¡¨ï¼Œæ”¯æŒå¤šå¯¹å¤šå…³ç³»
- âœ… æ¯ä¸ªä½æˆ·å›ºå®š5ä¸ªæŠ¤ç†äººå‘˜ä½ç½®
- âœ… æŠ¤å£«ç»„æ ‡ç­¾ç®¡ç†

---

### 6. **Devices (è®¾å¤‡è¡¨)**

#### ä¹‹å‰
```python
{
    "device_name": "Aæ¥¼1å±‚é›·è¾¾",
    "device_model": "TDP-V2-Pro",
    "device_type": "RADAR",
    "serial_number": "TDP20231001001",
    "uid": "TDP-RADAR-001",
    "comm_mode": "WiFi",
    "firmware_version": "2.1.0",
    "location_id": "...",
    "status": "online",
}
```

#### ç°åœ¨ (å¯¹é½11_devices.sql)
```python
{
    "device_name": "Aæ¥¼1å±‚é›·è¾¾",
    "device_model": "WF-RADAR-60G-V2",  # è¯¦ç»†å‹å·
    "device_type": "Radar",
    "serial_number": "TDP20231001001",
    "uid": "TDP-RADAR-001",
    "imei": None,  # âœ… æ–°å¢4Gè®¾å¤‡IMEI
    "comm_mode": "WiFi",
    "firmware_version": "2.1.0",
    "mcu_model": "ESP32",  # âœ… æ–°å¢MCUå‹å·
    
    # âœ… è¯¦ç»†çš„Location Binding
    "location_id": "...",
    "bound_room_id": "...",
    "bound_bed_id": "...",
    
    # âœ… æ›´è¯¦ç»†çš„çŠ¶æ€å­—æ®µ
    "status": "online",
    "installed": True,  # è®¾å¤‡æ˜¯å¦å·²å®‰è£…
    "business_access": True,  # æ˜¯å¦å…è®¸æ¥å…¥ç³»ç»Ÿ
    "monitoring_enabled": True,  # æ˜¯å¦å¯ç”¨ç›‘æŠ¤åŠŸèƒ½
    "installation_date_utc": "...",
    
    "metadata": {"notes": "ä¸»é›·è¾¾è®¾å¤‡"},
}
```

**æ”¹è¿›**: 
- âœ… æ·»åŠ MCUå‹å·ã€IMEIç­‰æŠ€æœ¯è§„æ ¼
- âœ… è¯¦ç»†çš„ç»‘å®šå…³ç³»ï¼ˆroomå’Œbedï¼‰
- âœ… æ›´ç»†ç²’åº¦çš„çŠ¶æ€æ§åˆ¶

---

## ğŸ“Š æ•°æ®é‡å¯¹æ¯”

| é¡¹ç›® | ä¹‹å‰ | ç°åœ¨ | è¯´æ˜ |
|------|------|------|------|
| ç§Ÿæˆ· | 1 | 1 | ç›¸åŒ |
| ç”¨æˆ· | 2 | 3 | å¢åŠ 1ä¸ªç®¡ç†å‘˜ï¼Œä½¿ç”¨æ ‡å‡†è§’è‰² |
| ä½æˆ· | 2 | 2 | ç›¸åŒï¼Œä½†å­—æ®µæ›´å®Œæ•´ |
| è”ç³»äºº | 0 | 2 | âœ… æ–°å¢ç‹¬ç«‹è¡¨ |
| æŠ¤ç†å…³è” | 0 | 2 | âœ… æ–°å¢ç‹¬ç«‹è¡¨ |
| è®¾å¤‡ | 2 | 2 | ç›¸åŒï¼Œä½†å­—æ®µæ›´å®Œæ•´ |
| IoTæ•°æ® | ~25 | ~25 | ç›¸åŒ |
| å¡ç‰‡ | 2 | 2 | ç›¸åŒ |

---

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. SHA-256 å“ˆå¸Œå­˜å‚¨
```python
def hash_contact(value: str) -> str:
    """ç”Ÿæˆè”ç³»æ–¹å¼çš„SHA-256å“ˆå¸Œ"""
    return hashlib.sha256(value.encode('utf-8')).hexdigest()
```

**ç”¨é€”**:
- ç”¨æˆ·ç™»å½•æ—¶éªŒè¯ï¼ˆä¸å­˜æ˜æ–‡ï¼‰
- ç¬¦åˆéšç§ä¿æŠ¤è¦æ±‚
- ä¸æºå‚è€ƒè®¾è®¡ä¸€è‡´

### 2. å‘Šè­¦é…ç½®
```python
"alert_levels": ["L1", "L2", "L3"],     # æ¥æ”¶çº§åˆ«
"alert_channels": ["APP", "EMAIL"],     # æ¥æ”¶é€šé“
"alert_scope": "ALL",                   # æ¥æ”¶èŒƒå›´
```

**ç”¨é€”**:
- ç”¨æˆ·è‡ªå®šä¹‰å‘Šè­¦æ¥æ”¶
- æ”¯æŒå‘Šè­¦è·¯ç”±å†³ç­–

### 3. å®¶åº­æ ‡ç­¾
```python
"family_tag": "FAMILY-WANG",
"family_member_account_1": None,
```

**ç”¨é€”**:
- æ ‡è¯†åŒä¸€å®¶åº­æˆå‘˜
- å¤«å¦»åŒä½å¯äº’ç›¸æŸ¥çœ‹çŠ¶æ€

### 4. è”ç³»äººæ§½ä½ç®¡ç†
```python
"slot": "A",  # A/B/C/D/E
```

**ç”¨é€”**:
- æ¯ä¸ªä½æˆ·æœ€å¤š5ä¸ªè”ç³»äºº
- æ§½ä½åŒ–ç®¡ç†ï¼Œæ˜“äºæ‰©å±•

### 5. æŠ¤ç†äººå‘˜å¤šé‡åˆ†é…
```python
"caregiver_id1": "...",  # 5ä¸ªIDä½ç½®
"caregiver_id2": "...",
# ...
"nurse_group_tags": ["Aç»„", "DayShift"],
```

**ç”¨é€”**:
- æ”¯æŒå¤šä¸ªæŠ¤ç†äººå‘˜åŒæ—¶è´Ÿè´£
- å›¢é˜Ÿæ ‡ç­¾ç®¡ç†

---

## ğŸ¯ å¯¹é½å®Œæˆåº¦

| SQLæ–‡ä»¶ | å¯¹é½çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|
| 01_tenants.sql | âœ… 100% | åŸºç¡€å­—æ®µå®Œå…¨å¯¹é½ |
| 03_users.sql | âœ… 95% | ç¼ºpassword/pinå®é™…å“ˆå¸Œå€¼ |
| 07_residents.sql | âœ… 100% | å®Œæ•´å­—æ®µï¼ŒåŒ…å«HISå’Œå“ˆå¸Œ |
| 09_resident_contacts.sql | âœ… 100% | æ–°å»ºç‹¬ç«‹è¡¨ |
| 10_resident_caregivers.sql | âœ… 100% | æ–°å»ºå…³è”è¡¨ |
| 11_devices.sql | âœ… 95% | ä¸»è¦å­—æ®µå®Œæ•´ |

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### æ¸…ç†æ—§æ•°æ®
```bash
cd backend
Remove-Item app/data/*.json -Force
```

### è¿è¡Œæ–°è„šæœ¬
```bash
python init_sample_data.py
```

### æœŸæœ›è¾“å‡º
```
======================================================================
ğŸš€ owlRD Sample Data Initialization (Source-Aligned Version)
======================================================================

ğŸ“– Aligning with reference schemas:
  - 01_tenants.sql
  - 03_users.sql
  - 07_residents.sql
  - 09_resident_contacts.sql
  - 10_resident_caregivers.sql
  - 11_devices.sql
======================================================================

ğŸ¢ Creating sample tenant...
âœ… Created tenant: ç¤ºä¾‹å…»è€é™¢

ğŸ‘¤ Creating sample users...
âœ… Created user: admin_user
âœ… Created user: nurse_zhang
âœ… Created user: nurse_li

ğŸ“ Creating sample locations...
âœ… Created location: Aæ¥¼
âœ… Created room: 101æˆ¿é—´
âœ… Created bed: 1å·åºŠ
âœ… Created bed: 2å·åºŠ

ğŸ§“ Creating sample residents...
âœ… Created resident: æ´»åŠ›è€äºº
âœ… Created resident: æ¸©å’Œè€äºº

ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Creating resident contacts...
âœ… Created contact: å°æ˜ç‹ (Slot A)
âœ… Created contact: å°çº¢æ (Slot A)

ğŸ‘¨â€âš•ï¸ Creating resident-caregiver assignments...
âœ… Created caregiver assignment for resident: 60000000-0000-0000-0000-000000000001
âœ… Created caregiver assignment for resident: 60000000-0000-0000-0000-000000000002

ğŸ“± Creating sample devices...
âœ… Created device: Aæ¥¼1å±‚é›·è¾¾
âœ… Created device: 101æˆ¿é—´å‹åŠ›æ¿

ğŸ“Š Creating sample IoT data...
âœ… Created 25 IoT data records

ğŸ´ Creating sample cards...
âœ… Created card: æ´»åŠ›è€äºº
âœ… Created card: Aæ¥¼å…¬å…±åŒºåŸŸ

======================================================================
âœ… Sample data initialization completed!
======================================================================

ğŸ“‹ Summary:
  - Tenants: 1
  - Users: 3 (1 Director + 2 Nurses)
  - Residents: 2 (with HIS integration fields)
  - Resident Contacts: 2 (family members)
  - Caregiver Assignments: 2
  - Devices: 2 (Radar + PressureMat)
  - IoT Data Records: ~25
  - Cards: 2

ğŸ”‘ Key IDs:
  - Tenant: 10000000-0000-0000-0000-000000000001
  - Admin User: 20000000-0000-0000-0000-000000000001
  - Resident 1: 60000000-0000-0000-0000-000000000001
  - Resident 2: 60000000-0000-0000-0000-000000000002

ğŸŒ API Access:
  - http://localhost:8000/docs
  - http://192.168.2.6:8000/docs

âœ¨ Features:
  âœ… HIS system integration fields
  âœ… SHA-256 hashed contact info (phone/email)
  âœ… Family tags for multi-resident families
  âœ… Separate contact records (09_resident_contacts)
  âœ… Caregiver assignments (10_resident_caregivers)
  âœ… Full device specs (11_devices)
```

---

## ğŸ’¡ é‡è¦è¯´æ˜

### 1. æ•°æ®å­˜å‚¨æ–¹å¼ä¸å˜
- ä»ç„¶ä½¿ç”¨JSONæ–‡ä»¶å­˜å‚¨
- ä½†**å­—æ®µç»“æ„**ä¸¥æ ¼æŒ‰ç…§PostgreSQL schema

### 2. æ¼”ç¤ºåŠŸèƒ½å®Œå…¨å…¼å®¹
- æ‰€æœ‰å‰ç«¯åŠŸèƒ½æ­£å¸¸æ˜¾ç¤º
- APIç«¯ç‚¹å®Œå…¨å…¼å®¹
- å¯ä»¥æ— ç¼åˆ‡æ¢

### 3. æœªæ¥è¿ç§»æ›´å®¹æ˜“
- å­—æ®µä¸€è‡´ï¼Œè¿ç§»åˆ°PostgreSQLæ—¶åªéœ€æ”¹å­˜å‚¨å±‚
- ä¸éœ€è¦ä¿®æ”¹æ•°æ®æ¨¡å‹
- å®Œå…¨ç”Ÿäº§å°±ç»ª

---

## ğŸ“ æ–‡ä»¶ä½ç½®

- **è„šæœ¬**: `backend/init_sample_data.py`
- **æ–‡æ¡£**: `é¡¹ç›®è®°å½•/ç¤ºä¾‹æ•°æ®æ›´æ–°è¯´æ˜.md`
- **æºå‚è€ƒ**: `owdRD_github_clone_æºå‚è€ƒæ–‡ä»¶/owlRD/db/*.sql`

---

**æ›´æ–°å®Œæˆæ—¶é—´**: 2025-11-20 20:06  
**ç‰ˆæœ¬**: 2.0 (Source-Aligned Version)  
**å¯¹é½æ–‡ä»¶æ•°**: 6ä¸ªSQL schema
