# 标准编码映射说明 (Mappings)

> 对应SQL: `16_mapping_tables.sql`  
> 创建时间: 2025-11-21

---

## 功能概述

提供IoT数据与医疗标准编码（SNOMED CT、LOINC）的映射关系管理，支持姿态识别和事件分类的标准化。

---

## 数据模型

### 1. PostureMapping (姿态映射)

| 字段 | 类型 | 说明 |
|------|------|------|
| mapping_id | UUID | 映射ID（主键）|
| tenant_id | UUID | 租户ID |
| raw_posture | string | 原始姿态值 |
| snomed_code | string | SNOMED CT编码 |
| snomed_display | string | SNOMED CT显示名称 |
| loinc_code | string | LOINC编码 |
| loinc_display | string | LOINC显示名称 |
| risk_level | string | 风险等级（low/medium/high）|
| description | string | 描述 |
| metadata | JSON | 元数据 |
| created_at | timestamp | 创建时间 |
| updated_at | timestamp | 更新时间 |

### 2. EventMapping (事件映射)

| 字段 | 类型 | 说明 |
|------|------|------|
| mapping_id | UUID | 映射ID（主键）|
| tenant_id | UUID | 租户ID |
| event_type | string | 事件类型 |
| event_subtype | string | 事件子类型 |
| snomed_code | string | SNOMED CT编码 |
| snomed_display | string | SNOMED CT显示名称 |
| loinc_code | string | LOINC编码 |
| loinc_display | string | LOINC显示名称 |
| severity | string | 严重程度 |
| description | string | 描述 |
| metadata | JSON | 元数据 |
| created_at | timestamp | 创建时间 |
| updated_at | timestamp | 更新时间 |

---

## API端点

### 姿态映射 (Posture)

#### 1. 获取姿态映射列表
```
GET /api/v1/mappings/postures?tenant_id={id}
```

#### 2. 获取姿态映射详情
```
GET /api/v1/mappings/postures/{mapping_id}
```

#### 3. 创建姿态映射
```
POST /api/v1/mappings/postures
```

**请求体**：
```json
{
  "tenant_id": "uuid",
  "raw_posture": "sitting",
  "snomed_code": "33586001",
  "snomed_display": "Sitting position",
  "risk_level": "low"
}
```

#### 4. 更新姿态映射
```
PUT /api/v1/mappings/postures/{mapping_id}
```

#### 5. 删除姿态映射
```
DELETE /api/v1/mappings/postures/{mapping_id}
```

### 事件映射 (Event)

#### 1. 获取事件映射列表
```
GET /api/v1/mappings/events?tenant_id={id}
```

#### 2. 获取事件映射详情
```
GET /api/v1/mappings/events/{mapping_id}
```

#### 3. 创建事件映射
```
POST /api/v1/mappings/events
```

**请求体**：
```json
{
  "tenant_id": "uuid",
  "event_type": "Fall",
  "snomed_code": "217082002",
  "snomed_display": "Accidental fall",
  "severity": "high"
}
```

#### 4. 更新事件映射
```
PUT /api/v1/mappings/events/{mapping_id}
```

#### 5. 删除事件映射
```
DELETE /api/v1/mappings/events/{mapping_id}
```

---

## 医疗标准编码

### SNOMED CT (Systematized Nomenclature of Medicine)
- 国际医疗术语标准
- 用于临床数据交换
- 覆盖疾病、症状、体征、操作等

**示例**：
- `217082002` - Accidental fall（意外跌倒）
- `33586001` - Sitting position（坐位）
- `40199007` - Supine body position（仰卧位）

### LOINC (Logical Observation Identifiers Names and Codes)
- 观察指标标准编码
- 用于实验室和临床观察
- 支持数据互操作

**示例**：
- `8867-4` - Heart rate（心率）
- `9279-1` - Respiratory rate（呼吸率）
- `39156-5` - Body mass index (BMI)

---

## 使用场景

### 1. 姿态识别标准化
```
原始数据: "sitting"
↓ 映射
SNOMED: 33586001 "Sitting position"
LOINC: (可选)
风险等级: low
```

### 2. 事件分类
```
原始事件: "Fall"
↓ 映射
SNOMED: 217082002 "Accidental fall"
LOINC: (可选)
严重程度: high
```

### 3. FHIR数据转换
```json
{
  "resourceType": "Observation",
  "code": {
    "coding": [{
      "system": "http://snomed.info/sct",
      "code": "33586001",
      "display": "Sitting position"
    }]
  }
}
```

---

## 核心特性

### ✅ 标准编码支持
- SNOMED CT编码
- LOINC编码
- 双标准映射

### ✅ 风险评估
- 自动风险等级判断
- 支持自定义规则
- 告警触发依据

### ✅ 多租户隔离
- 租户独立映射配置
- 支持自定义扩展
- 灵活配置管理

### ✅ 数据互操作
- FHIR兼容
- HL7标准支持
- 跨系统数据交换

---

## 预定义映射示例

### 姿态映射
| 原始姿态 | SNOMED Code | 显示名称 | 风险等级 |
|---------|-------------|---------|---------|
| lying | 102538003 | Recumbent body position | low |
| sitting | 33586001 | Sitting position | low |
| standing | 10904000 | Orthostatic body position | medium |
| falling | 217082002 | Accidental fall | high |

### 事件映射
| 事件类型 | SNOMED Code | 显示名称 | 严重程度 |
|---------|-------------|---------|---------|
| Fall | 217082002 | Accidental fall | high |
| AbnormalHeartRate | 3424008 | Tachycardia | medium |
| LeftBed | 129836007 | Mobility | low |
| ApneaHypopnea | 427086000 | Sleep apnea | high |

---

## 实现状态

- ✅ 后端Model (mapping.py)
- ✅ 后端API (mappings.py) - 10个端点
- ✅ 示例数据 (posture_mapping.json, event_mapping.json)
- ✅ 前端类型 (PostureMapping, EventMapping)
- ⏳ 前端页面（待开发）
- ✅ 文档

**完成度**: 83%

---

## 参考资料

- [SNOMED CT Browser](https://browser.ihtsdotools.org/)
- [LOINC Search](https://loinc.org/)
- [FHIR CodeableConcept](https://www.hl7.org/fhir/datatypes.html#CodeableConcept)

---

**最后更新**: 2025-11-21
