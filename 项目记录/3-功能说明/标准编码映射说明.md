# æ ‡å‡†ç¼–ç æ˜ å°„è¯´æ˜ (Mappings)

> å¯¹åº”SQL: `16_mapping_tables.sql`  
> åˆ›å»ºæ—¶é—´: 2025-11-21

---

## åŠŸèƒ½æ¦‚è¿°

æä¾›IoTæ•°æ®ä¸åŒ»ç–—æ ‡å‡†ç¼–ç ï¼ˆSNOMED CTã€LOINCï¼‰çš„æ˜ å°„å…³ç³»ç®¡ç†ï¼Œæ”¯æŒå§¿æ€è¯†åˆ«å’Œäº‹ä»¶åˆ†ç±»çš„æ ‡å‡†åŒ–ã€?
---

## æ•°æ®æ¨¡å‹

### 1. PostureMapping (å§¿æ€æ˜ å°?

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| mapping_id | UUID | æ˜ å°„IDï¼ˆä¸»é”®ï¼‰|
| tenant_id | UUID | ç§Ÿæˆ·ID |
| raw_posture | string | åŸå§‹å§¿æ€å€?|
| snomed_code | string | SNOMED CTç¼–ç  |
| snomed_display | string | SNOMED CTæ˜¾ç¤ºåç§° |
| loinc_code | string | LOINCç¼–ç  |
| loinc_display | string | LOINCæ˜¾ç¤ºåç§° |
| risk_level | string | é£é™©ç­‰çº§ï¼ˆlow/medium/highï¼‰|
| description | string | æè¿° |
| metadata | JSON | å…ƒæ•°æ?|
| created_at | timestamp | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ |

### 2. EventMapping (äº‹ä»¶æ˜ å°„)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| mapping_id | UUID | æ˜ å°„IDï¼ˆä¸»é”®ï¼‰|
| tenant_id | UUID | ç§Ÿæˆ·ID |
| event_type | string | äº‹ä»¶ç±»å‹ |
| event_subtype | string | äº‹ä»¶å­ç±»å?|
| snomed_code | string | SNOMED CTç¼–ç  |
| snomed_display | string | SNOMED CTæ˜¾ç¤ºåç§° |
| loinc_code | string | LOINCç¼–ç  |
| loinc_display | string | LOINCæ˜¾ç¤ºåç§° |
| severity | string | ä¸¥é‡ç¨‹åº¦ |
| description | string | æè¿° |
| metadata | JSON | å…ƒæ•°æ?|
| created_at | timestamp | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ |

---

## APIç«¯ç‚¹

### å§¿æ€æ˜ å°?(Posture)

#### 1. è·å–å§¿æ€æ˜ å°„åˆ—è¡?```
GET /api/v1/mappings/postures?tenant_id={id}
```

#### 2. è·å–å§¿æ€æ˜ å°„è¯¦æƒ?```
GET /api/v1/mappings/postures/{mapping_id}
```

#### 3. åˆ›å»ºå§¿æ€æ˜ å°?```
POST /api/v1/mappings/postures
```

**è¯·æ±‚ä½?*ï¼?```json
{
  "tenant_id": "uuid",
  "raw_posture": "sitting",
  "snomed_code": "33586001",
  "snomed_display": "Sitting position",
  "risk_level": "low"
}
```

#### 4. æ›´æ–°å§¿æ€æ˜ å°?```
PUT /api/v1/mappings/postures/{mapping_id}
```

#### 5. åˆ é™¤å§¿æ€æ˜ å°?```
DELETE /api/v1/mappings/postures/{mapping_id}
```

### äº‹ä»¶æ˜ å°„ (Event)

#### 1. è·å–äº‹ä»¶æ˜ å°„åˆ—è¡¨
```
GET /api/v1/mappings/events?tenant_id={id}
```

#### 2. è·å–äº‹ä»¶æ˜ å°„è¯¦æƒ…
```
GET /api/v1/mappings/events/{mapping_id}
```

#### 3. åˆ›å»ºäº‹ä»¶æ˜ å°„
```
POST /api/v1/mappings/events
```

**è¯·æ±‚ä½?*ï¼?```json
{
  "tenant_id": "uuid",
  "event_type": "Fall",
  "snomed_code": "217082002",
  "snomed_display": "Accidental fall",
  "severity": "high"
}
```

#### 4. æ›´æ–°äº‹ä»¶æ˜ å°„
```
PUT /api/v1/mappings/events/{mapping_id}
```

#### 5. åˆ é™¤äº‹ä»¶æ˜ å°„
```
DELETE /api/v1/mappings/events/{mapping_id}
```

---

## åŒ»ç–—æ ‡å‡†ç¼–ç 

### SNOMED CT (Systematized Nomenclature of Medicine)
- å›½é™…åŒ»ç–—æœ¯è¯­æ ‡å‡†
- ç”¨äºä¸´åºŠæ•°æ®äº¤æ¢
- è¦†ç›–ç–¾ç—…ã€ç—‡çŠ¶ã€ä½“å¾ã€æ“ä½œç­‰

**ç¤ºä¾‹**ï¼?- `217082002` - Accidental fallï¼ˆæ„å¤–è·Œå€’ï¼‰
- `33586001` - Sitting positionï¼ˆåä½ï¼‰
- `40199007` - Supine body positionï¼ˆä»°å§ä½ï¼?
### LOINC (Logical Observation Identifiers Names and Codes)
- è§‚å¯ŸæŒ‡æ ‡æ ‡å‡†ç¼–ç 
- ç”¨äºå®éªŒå®¤å’Œä¸´åºŠè§‚å¯Ÿ
- æ”¯æŒæ•°æ®äº’æ“ä½?
**ç¤ºä¾‹**ï¼?- `8867-4` - Heart rateï¼ˆå¿ƒç‡ï¼‰
- `9279-1` - Respiratory rateï¼ˆå‘¼å¸ç‡ï¼?- `39156-5` - Body mass index (BMI)

---

## ä½¿ç”¨åœºæ™¯

### 1. å§¿æ€è¯†åˆ«æ ‡å‡†åŒ–
```
åŸå§‹æ•°æ®: "sitting"
â†?æ˜ å°„
SNOMED: 33586001 "Sitting position"
LOINC: (å¯é€?
é£é™©ç­‰çº§: low
```

### 2. äº‹ä»¶åˆ†ç±»
```
åŸå§‹äº‹ä»¶: "Fall"
â†?æ˜ å°„
SNOMED: 217082002 "Accidental fall"
LOINC: (å¯é€?
ä¸¥é‡ç¨‹åº¦: high
```

### 3. FHIRæ•°æ®è½¬æ¢
```json
{
  "resourceType": "Observation",
  "code": {
    "coding": [{
      "system": "http://snomed.info/sct",
      "code": "33586001",
      "display": "Sitting position"
    }]
  }
}
```

---

## æ ¸å¿ƒç‰¹æ€?
### âœ?æ ‡å‡†ç¼–ç æ”¯æŒ
- SNOMED CTç¼–ç 
- LOINCç¼–ç 
- åŒæ ‡å‡†æ˜ å°?
### âœ?é£é™©è¯„ä¼°
- è‡ªåŠ¨é£é™©ç­‰çº§åˆ¤æ–­
- æ”¯æŒè‡ªå®šä¹‰è§„åˆ?- å‘Šè­¦è§¦å‘ä¾æ®

### âœ?å¤šç§Ÿæˆ·éš”ç¦?- ç§Ÿæˆ·ç‹¬ç«‹æ˜ å°„é…ç½®
- æ”¯æŒè‡ªå®šä¹‰æ‰©å±?- çµæ´»é…ç½®ç®¡ç†

### âœ?æ•°æ®äº’æ“ä½?- FHIRå…¼å®¹
- HL7æ ‡å‡†æ”¯æŒ
- è·¨ç³»ç»Ÿæ•°æ®äº¤æ?
---

## é¢„å®šä¹‰æ˜ å°„ç¤ºä¾?
### å§¿æ€æ˜ å°?| åŸå§‹å§¿æ€?| SNOMED Code | æ˜¾ç¤ºåç§° | é£é™©ç­‰çº§ |
|---------|-------------|---------|---------|
| lying | 102538003 | Recumbent body position | low |
| sitting | 33586001 | Sitting position | low |
| standing | 10904000 | Orthostatic body position | medium |
| falling | 217082002 | Accidental fall | high |

### äº‹ä»¶æ˜ å°„
| äº‹ä»¶ç±»å‹ | SNOMED Code | æ˜¾ç¤ºåç§° | ä¸¥é‡ç¨‹åº¦ |
|---------|-------------|---------|---------|
| Fall | 217082002 | Accidental fall | high |
| AbnormalHeartRate | 3424008 | Tachycardia | medium |
| LeftBed | 129836007 | Mobility | low |
| ApneaHypopnea | 427086000 | Sleep apnea | high |

---

## å®ç°çŠ¶æ€?
- âœ?åç«¯Model (mapping.py)
- âœ?åç«¯API (mappings.py) - 10ä¸ªç«¯ç‚?- âœ?ç¤ºä¾‹æ•°æ® (posture_mapping.json, event_mapping.json)
- âœ?å‰ç«¯ç±»å‹ (PostureMapping, EventMapping)
- â?å‰ç«¯é¡µé¢ï¼ˆå¾…å¼€å‘ï¼‰
- âœ?æ–‡æ¡£

**å®Œæˆåº?*: 83%

---

## å‚è€ƒèµ„æ–?
- [SNOMED CT Browser](https://browser.ihtsdotools.org/)
- [LOINC Search](https://loinc.org/)
- [FHIR CodeableConcept](https://www.hl7.org/fhir/datatypes.html#CodeableConcept)

---

**æœ€åæ›´æ–?*: 2025-11-21
