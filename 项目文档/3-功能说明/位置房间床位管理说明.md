# ä½ç½®æˆ¿é—´åºŠä½ç®¡ç†è¯´æ˜ (Locations, Rooms, Beds)

> å¯¹åº”SQL: `04_locations.sql`, `05_rooms.sql`, `06_beds.sql`  
> åˆ›å»ºæ—¶é—´: 2025-11-21

---

## åŠŸèƒ½æ¦‚è¿°

ä¸‰å±‚ç©ºé—´ç®¡ç†æ¶æ„ï¼Œæä¾›å®Œæ•´çš„å…»è€é™¢/å®¶åº­æŠ¤ç†åœºæ‰€ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒè®¾å¤‡ç»‘å®šã€ä½æˆ·åˆ†é…å’Œå‘Šè­¦è·¯ç”±é…ç½®ã€?
```
Location (ä½ç½®/åœºæ‰€)
  â””â”€â”€ Room (æˆ¿é—´)
        â””â”€â”€ Bed (åºŠä½)
```

---

## ä¸€ã€Location (ä½ç½®/åœºæ‰€)

### æ•°æ®æ¨¡å‹

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| location_id | UUID | ä½ç½®IDï¼ˆä¸»é”®ï¼‰|
| tenant_id | UUID | ç§Ÿæˆ·ID |
| **ä½ç½®æ ‡è¯†** | | |
| location_tag | string | ä½ç½®æ ‡ç­¾ï¼ˆå¦‚"Aé™¢åŒºä¸»æ¥¼"ï¼‰|
| location_name | string | ä½ç½®åç§°ï¼ˆå¦‚"201"ã€?E203"ï¼‰|
| **Institutionalåœºæ™¯** | | |
| building | string | æ¥¼æ ‹ï¼ˆå¦‚"Building A"ï¼‰|
| floor | string | æ¥¼å±‚ï¼ˆå¦‚"1F"ã€?2F"ï¼‰|
| area_id | string | åŒºåŸŸIDï¼ˆå¦‚"Memory Care Unit"ï¼‰|
| door_number | string | é—¨ç‰Œå?æˆ¿é—´å?|
| **åœºæ™¯é…ç½®** | | |
| layout_config | JSON | æˆ¿é—´å¸ƒå±€é…ç½®ï¼ˆvue_radaræ ¼å¼ï¼‰|
| location_type | string | åœºæ™¯ç±»å‹ï¼šInstitutional/HomeCare |
| primary_resident_id | UUID | ä¸»è¦å…³è”ä½æˆ·ID |
| **ç©ºé—´å±æ€?* | | |
| is_public_space | boolean | æ˜¯å¦å…¬å…±ç©ºé—´ï¼ˆå¤§å…ã€èµ°å»Šï¼‰|
| is_multi_person_room | boolean | æ˜¯å¦å¤šäººæˆ¿é—´ |
| **å‘Šè­¦è·¯ç”±** | | |
| timezone | string | IANAæ—¶åŒºï¼ˆå¦‚"America/Los_Angeles"ï¼‰|
| alert_user_ids | UUID[] | å‘Šè­¦æ¥æ”¶è€…IDåˆ—è¡¨ |
| alert_tags | string[] | å‘Šè­¦æ¥æ”¶è€…æ ‡ç­¾ç»„ |
| is_active | boolean | æ˜¯å¦å¯ç”¨ç›‘æ§ |
| created_at | timestamp | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ |

### APIç«¯ç‚¹

#### 1. è·å–ä½ç½®åˆ—è¡¨
```
GET /api/v1/locations?tenant_id={id}
```

#### 2. è·å–ä½ç½®è¯¦æƒ…
```
GET /api/v1/locations/{location_id}
```

#### 3. åˆ›å»ºä½ç½®
```
POST /api/v1/locations
```

**è¯·æ±‚ä½“ç¤ºä¾?*ï¼?```json
{
  "tenant_id": "uuid",
  "location_name": "Room 201",
  "building": "Main Building",
  "floor": "2F",
  "door_number": "201",
  "location_type": "Institutional",
  "is_public_space": false,
  "is_multi_person_room": false,
  "timezone": "America/Los_Angeles",
  "alert_user_ids": ["user1", "user2"],
  "is_active": true
}
```

#### 4. æ›´æ–°ä½ç½®
```
PUT /api/v1/locations/{location_id}
```

#### 5. åˆ é™¤ä½ç½®
```
DELETE /api/v1/locations/{location_id}
```

### ä½¿ç”¨åœºæ™¯

#### åœºæ™¯1ï¼šæœºæ„å¼å…»è€é™¢
```json
{
  "location_type": "Institutional",
  "building": "Aæ ?,
  "floor": "3F",
  "door_number": "301",
  "is_multi_person_room": true
}
```

#### åœºæ™¯2ï¼šå®¶åº­æŠ¤ç?```json
{
  "location_type": "HomeCare",
  "location_name": "Home-001",
  "primary_resident_id": "resident_uuid",
  "is_public_space": false
}
```

#### åœºæ™¯3ï¼šå…¬å…±ç©ºé—?```json
{
  "location_name": "Main Lobby",
  "is_public_space": true,
  "alert_user_ids": ["security_staff"]
}
```

---

## äºŒã€Room (æˆ¿é—´)

### æ•°æ®æ¨¡å‹

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| room_id | UUID | æˆ¿é—´IDï¼ˆä¸»é”®ï¼‰|
| location_id | UUID | æ‰€å±ä½ç½®ID |
| tenant_id | UUID | ç§Ÿæˆ·ID |
| is_default | boolean | æ˜¯å¦é»˜è®¤æˆ¿é—´ |
| room_name | string | æˆ¿é—´åç§°ï¼ˆå¦‚"Bedroom"ã€?Bathroom"ï¼‰|
| is_active | boolean | æ˜¯å¦å¯ç”¨ |
| layout_config | JSON | æˆ¿é—´çº§ç‹¬ç«‹å¸ƒå±€é…ç½® |
| created_at | timestamp | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ |

### APIç«¯ç‚¹

#### 1. è·å–æˆ¿é—´åˆ—è¡¨
```
GET /api/v1/rooms?location_id={id}
```

#### 2. è·å–æˆ¿é—´è¯¦æƒ…
```
GET /api/v1/rooms/{room_id}
```

#### 3. åˆ›å»ºæˆ¿é—´
```
POST /api/v1/rooms
```

**è¯·æ±‚ä½“ç¤ºä¾?*ï¼?```json
{
  "location_id": "location_uuid",
  "tenant_id": "tenant_uuid",
  "room_name": "Bedroom",
  "is_default": true,
  "is_active": true
}
```

#### 4. æ›´æ–°æˆ¿é—´
```
PUT /api/v1/rooms/{room_id}
```

#### 5. åˆ é™¤æˆ¿é—´
```
DELETE /api/v1/rooms/{room_id}
```

### ä½¿ç”¨åœºæ™¯

#### æ ‡å‡†æˆ¿é—´é…ç½®
```
Location: "Room 201"
  â”œâ”€â”€ Room: "Bedroom" (is_default: true)
  â”œâ”€â”€ Room: "Bathroom"
  â””â”€â”€ Room: "Living Area"
```

---

## ä¸‰ã€Bed (åºŠä½)

### æ•°æ®æ¨¡å‹

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| bed_id | UUID | åºŠä½IDï¼ˆä¸»é”®ï¼‰|
| room_id | UUID | æ‰€å±æˆ¿é—´ID |
| location_id | UUID | æ‰€å±ä½ç½®ID |
| tenant_id | UUID | ç§Ÿæˆ·ID |
| bed_name | string | åºŠä½åç§°ï¼ˆå¦‚"A"ã€?B"ï¼‰|
| bed_type | string | åºŠä½ç±»å‹ï¼šActiveBed/NonActiveBed |
| mattress_material | string | åºŠå«æè´¨/ç±»å‹ |
| mattress_thickness | string | åºŠå«åšåº¦ï¼ˆå¦‚"< 7in"ï¼‰|
| resident_id | UUID | ç»‘å®šçš„ä½æˆ·ID |
| created_at | timestamp | åˆ›å»ºæ—¶é—´ |
| updated_at | timestamp | æ›´æ–°æ—¶é—´ |

### Bed Type è¯´æ˜

#### ActiveBedï¼ˆæ´»åŠ¨åºŠä½ï¼‰
- æœ‰ä½æˆ·å…¥ä½?- æœ‰IoTè®¾å¤‡ç›‘æ§
- ç”¨äºç²¾ç¡®å‘Šè­¦è·¯ç”±

#### NonActiveBedï¼ˆéæ´»åŠ¨åºŠä½ï¼?- ç©ºåºŠæˆ–æ— è®¾å¤‡
- ä¸ç”ŸæˆActiveBedå¡ç‰‡

### APIç«¯ç‚¹

#### 1. è·å–åºŠä½åˆ—è¡¨
```
GET /api/v1/beds?room_id={id}
GET /api/v1/beds?location_id={id}
```

#### 2. è·å–åºŠä½è¯¦æƒ…
```
GET /api/v1/beds/{bed_id}
```

#### 3. åˆ›å»ºåºŠä½
```
POST /api/v1/beds
```

**è¯·æ±‚ä½“ç¤ºä¾?*ï¼?```json
{
  "room_id": "room_uuid",
  "location_id": "location_uuid",
  "tenant_id": "tenant_uuid",
  "bed_name": "A",
  "bed_type": "ActiveBed",
  "mattress_material": "Memory Foam",
  "mattress_thickness": "7-10in",
  "resident_id": "resident_uuid"
}
```

#### 4. æ›´æ–°åºŠä½
```
PUT /api/v1/beds/{bed_id}
```

#### 5. åˆ é™¤åºŠä½
```
DELETE /api/v1/beds/{bed_id}
```

### ä½¿ç”¨åœºæ™¯

#### åœºæ™¯1ï¼šå•äººæˆ¿
```
Location: "Room 201"
  â””â”€â”€ Room: "Bedroom"
        â””â”€â”€ Bed: "A" (ActiveBed)
```

#### åœºæ™¯2ï¼šå¤šäººæˆ¿
```
Location: "Room 201"
  â””â”€â”€ Room: "Bedroom"
        â”œâ”€â”€ Bed: "A" (ActiveBed, resident_id: xxx)
        â”œâ”€â”€ Bed: "B" (ActiveBed, resident_id: yyy)
        â””â”€â”€ Bed: "C" (NonActiveBed)
```

---

## æ ¸å¿ƒç‰¹æ€?
### âœ?ä¸‰å±‚æ¶æ„
- Location â†?Room â†?Bed
- çµæ´»çš„ç©ºé—´ç»„ç»?- æ”¯æŒå¤æ‚åœºæ™¯

### âœ?å¤šåœºæ™¯æ”¯æŒ?- æœºæ„å¼å…»è€é™¢ï¼ˆInstitutionalï¼?- å®¶åº­æŠ¤ç†ï¼ˆHomeCareï¼?- å…¬å…±ç©ºé—´ç®¡ç†

### âœ?å‘Šè­¦è·¯ç”±é›†æˆ
- Locationçº§åˆ«å‘Šè­¦é…ç½®
- ActiveBedç²¾ç¡®è·¯ç”±
- æ”¯æŒç”¨æˆ·ç»„å’Œæ ‡ç­¾

### âœ?è®¾å¤‡ç»‘å®š
- Bedç»‘å®šIoTè®¾å¤‡
- è‡ªåŠ¨è§¦å‘å¡ç‰‡ç”Ÿæˆ
- æ”¯æŒè®¾å¤‡çŠ¶æ€ç›‘æ?
### âœ?ä½æˆ·ç®¡ç†
- åºŠä½åˆ†é…
- å…¥ä½çŠ¶æ€è¿½è¸?- è‡ªåŠ¨å¡ç‰‡æ›´æ–°

---

## æ•°æ®å…³ç³»

### Location â†?Room â†?Bed
```
Location {location_id}
  â†?Room {location_id}
  â†?Bed {room_id, location_id}
  â†?Resident {bed_id}
Device {bed_id}
```

### å‘Šè­¦è·¯ç”±å…³ç³»
```
Alert â†?Device â†?Bed â†?Location â†?Card â†?Users
```

---

## æœ€ä½³å®è·?
### 1. Locationå‘½åè§„èŒƒ
```
Institutionalåœºæ™¯:
- location_name: "201", "E203", "Room 301"
- building + floor + door_number: å®Œæ•´åœ°å€

HomeCareåœºæ™¯:
- location_name: "Home-001", "Smith Residence"
- ä½¿ç”¨primary_resident_idå…³è”
```

### 2. Roomé…ç½®
```
æ ‡å‡†é…ç½®:
- æ¯ä¸ªLocationè‡³å°‘1ä¸ªRoom
- is_default: true æ ‡è®°ä¸»æˆ¿é—?- åˆç†å‘½å: "Bedroom", "Bathroom", "Living Area"
```

### 3. Bedç®¡ç†
```
åºŠä½å‘½å:
- å•äººæˆ? "A" æˆ?"Bed1"
- å¤šäººæˆ? "A", "B", "C" æˆ?"Bed1", "Bed2", "Bed3"

ActiveBedæ¡ä»¶:
1. bed_type = "ActiveBed"
2. resident_id != null
3. æœ‰ç»‘å®šçš„åœ¨çº¿è®¾å¤‡
```

### 4. å‘Šè­¦é…ç½®
```
ä¼˜å…ˆçº?
1. ActiveBedå¡ç‰‡ (ç²¾ç¡®åˆ°åºŠä½?
2. Locationå¡ç‰‡ (ä½ç½®çº§åˆ«)
3. ç§Ÿæˆ·é»˜è®¤æ¥æ”¶è€?```

---

## ç¤ºä¾‹æ•°æ®

### Locationç¤ºä¾‹
```json
{
  "location_id": "uuid",
  "tenant_id": "uuid",
  "location_name": "Room 201",
  "building": "Main Building",
  "floor": "2F",
  "door_number": "201",
  "location_type": "Institutional",
  "is_public_space": false,
  "is_multi_person_room": true,
  "timezone": "America/Los_Angeles",
  "alert_user_ids": ["nurse1_id", "nurse2_id"],
  "is_active": true
}
```

### Roomç¤ºä¾‹
```json
{
  "room_id": "uuid",
  "location_id": "location_uuid",
  "tenant_id": "tenant_uuid",
  "room_name": "Bedroom",
  "is_default": true,
  "is_active": true
}
```

### Bedç¤ºä¾‹
```json
{
  "bed_id": "uuid",
  "room_id": "room_uuid",
  "location_id": "location_uuid",
  "tenant_id": "tenant_uuid",
  "bed_name": "A",
  "bed_type": "ActiveBed",
  "mattress_material": "Memory Foam",
  "mattress_thickness": "7-10in",
  "resident_id": "resident_uuid"
}
```

---

## å®ç°çŠ¶æ€?
### Location
- âœ?åç«¯Model (location.py)
- âœ?åç«¯API (locations.py)
- âœ?ç¤ºä¾‹æ•°æ® (locations.json)
- âœ?å‰ç«¯ç±»å‹ (Location)
- â?å‰ç«¯é¡µé¢ï¼ˆå¾…å¼€å‘ï¼‰
- âœ?æ–‡æ¡£

**å®Œæˆåº?*: 83%

### Room
- âœ?åç«¯Model (location.pyä¸­Roomç±?
- âœ?åç«¯API (rooms.py)
- âœ?ç¤ºä¾‹æ•°æ® (rooms.json)
- âœ?å‰ç«¯ç±»å‹ (Room)
- â?å‰ç«¯é¡µé¢ï¼ˆå¾…å¼€å‘ï¼‰
- âœ?æ–‡æ¡£

**å®Œæˆåº?*: 83%

### Bed
- âœ?åç«¯Model (location.pyä¸­Bedç±?
- âœ?åç«¯API (beds.py)
- âœ?ç¤ºä¾‹æ•°æ® (beds.json)
- âœ?å‰ç«¯ç±»å‹ (Bed)
- â?å‰ç«¯é¡µé¢ï¼ˆå¾…å¼€å‘ï¼‰
- âœ?æ–‡æ¡£

**å®Œæˆåº?*: 83%

---

## ç›¸å…³åŠŸèƒ½

- **Cards**: åŸºäºLocationå’ŒBedè‡ªåŠ¨ç”Ÿæˆ
- **Alerts**: ä½¿ç”¨Locationå‘Šè­¦è·¯ç”±é…ç½®
- **Devices**: ç»‘å®šåˆ°Bed
- **Residents**: åˆ†é…åˆ°Bed

---

**æœ€åæ›´æ–?*: 2025-11-21
