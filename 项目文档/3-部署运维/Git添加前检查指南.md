# Git添加前检查指南

**创建时间**: 2025-11-27  
**更新时间**: 2025-11-27 16:30
**目的**: 避免误提交临时文件、空文件和旧目录  

---

## 🎯 为什么需要检查？

### 常见问题

使用 `git add -A` 或 `git add .` 会**无差别添加所有文件**，可能导致：

1. ❌ 提交临时文件（test.py, temp.md等）
2. ❌ 提交空文件（0字节）
3. ❌ 提交旧目录（已重命名但未删除）
4. ❌ 提交不应该在Git中的文件

### 历史教训

**2025-11-27 发生的问题**：
- 误提交了 `.windsurfrules/`（旧目录）
- 误提交了 `add_frontmatter.py`（空文件）
- 误提交了 `simplify_remaining.py`（空文件）
- 误提交了 `项目记录/`（旧目录名）

---

## ✅ AI自动遵守规则

### 🤖 Windsurf规则系统

AI已被配置为自动遵守 **10-Git操作规范.md**，会在每次Git操作时：

- ✅ **自动检查** 工作区状态
- ✅ **自动识别** 可疑文件
- ✅ **自动避免** `git add -A`
- ✅ **自动选择** 正确的文件
- ✅ **自动提示** 发现的问题

**无需手动运行脚本，AI会自动执行检查！**

---

## 📋 推荐流程

### 方法1：让AI处理（推荐）⭐

```powershell
# 只需告诉AI要提交什么
# AI会自动：
# 1. 检查工作区
# 2. 识别可疑文件
# 3. 选择性添加
# 4. 确认后提交

# 示例：
"请提交开发记录文件"
# AI会自动检查并只添加正确的文件
```

### 方法2：手动检查流程

```powershell
# 步骤1: 查看工作区状态
git status

# 步骤2: 仔细查看每个文件
#   - 新文件（??）：是否应该提交？
#   - 修改文件（M）：修改是否正确？
#   - 删除文件（D）：确认删除？

# 步骤3: 选择性添加
git add <文件路径>

# 步骤4: 再次确认
git status
git diff --cached

# 步骤5: 提交
git commit -m "描述"
```

---

## 🚫 禁止的操作

### ❌ 绝对不要这样做

```powershell
# 1. 不检查就批量添加
git add -A   # ❌ 危险！AI已被配置禁止使用
git add .    # ❌ 危险！AI已被配置禁止使用

# 2. 不看git status就提交
git commit -m "update"  # ❌ 不知道提交了什么

# 3. 忽略警告信息
# 看到可疑文件警告，但仍然继续提交
```

---

## ✅ 推荐的操作

### ✅ 安全的做法

```powershell
# 1. 让AI检查（自动）
# AI会自动运行 git status 并分析

# 2. 选择性添加（AI会自动执行）
git add "项目文档/2-开发记录/2025-11-27_功能开发.md"
git add ".windsurf/rules/05-测试组织规范.md"

# 3. 提交前确认
git status
git diff --cached --name-only

# 4. 确认无误再提交
git commit -m "docs: 添加功能开发记录和测试规范"

# 5. 推送前最后检查
git log --oneline -3
git push origin main
```

---

## 📝 .gitignore 配置

### 已配置的忽略规则

```gitignore
# 临时文件
add_frontmatter.py
simplify_remaining.py
*_temp.py
*_test.py
*.tmp
*.log

# 旧目录
.windsurfrules/
项目记录/

# 自动生成的报告
项目文档/完成度报告_*.md
```

---

## 🔧 常见场景

### 场景1：添加新的开发记录

```powershell
# ✅ AI会自动处理
"请提交2025-11-27的开发记录"

# AI会：
# 1. 检查工作区
# 2. 找到对应文件
# 3. 验证文件名格式
# 4. 选择性添加
# 5. 提交
```

### 场景2：添加新的规则文件

```powershell
# ✅ AI会自动处理
"请提交新的规则文件"

# AI会自动检查并只添加规则文件
```

---

## 📊 检查清单

### 提交前必查项

- [ ] ✅ AI自动检查了工作区状态
- [ ] ✅ AI自动识别了可疑文件
- [ ] ✅ AI使用了选择性添加
- [ ] ✅ 确认没有临时文件
- [ ] ✅ 确认没有空文件
- [ ] ✅ 确认没有旧目录
- [ ] ✅ 提交信息清晰明确

---

## �� 最佳实践总结

### 核心原则

1. **🤖 信任AI** - AI已配置Git操作规范
2. **✅ 选择性添加** - 明确指定每个文件
3. **📋 提交前确认** - 查看 `git diff --cached`
4. **🚫 避免批量操作** - 不用 `git add -A`
5. **📝 维护 .gitignore** - 及时添加忽略规则

---

## 🆘 紧急处理

### 如果已经误提交了

```powershell
# 方案1: 从Git中删除，但保留本地
git rm --cached <文件>
git commit -m "chore: 删除误提交的文件"
git push origin main

# 方案2: 回退提交（未推送的情况）
git reset HEAD~1  # 回退一个提交
```

---

## �� 获取帮助

**遇到问题时**：
1. 查看本文档
2. 查看 `.windsurf/rules/10-Git操作规范.md`
3. 执行 `git status` 了解状态
4. 信任AI的自动检查

**参考资源**：
- `.windsurf/rules/10-Git操作规范.md` - AI遵守的规则
- `.gitignore` - 忽略规则
- 项目文档/3-部署运维/ - 其他运维文档

---

**记住：AI会自动检查，您只需关注提交内容！** 🎯

**创建日期**: 2025-11-27  
**更新日期**: 2025-11-27 16:30  
**维护者**: Benson  
**状态**: ✅ 活跃维护