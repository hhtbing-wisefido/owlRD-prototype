# å‰åç«¯æ•°æ®ç»“æ„å¯¹åº”æ£€æŸ¥æŠ¥å‘?
**æ£€æŸ¥æ—¶é—?*: 2025-11-20 20:16  
**æ£€æŸ¥èŒƒå›?*: init_sample_data.py æ›´æ–°åçš„æ•°æ®ç»“æ„ä¸å‰åç«¯å¯¹åº”æƒ…å†µ

---

## ğŸ“Š æ€»ä½“ç»“è®º

| å±‚çº§ | çŠ¶æ€?| è¯´æ˜ |
|------|------|------|
| **åç«¯Models** | âœ?å®Œå…¨æ”¯æŒ | æ‰€æœ‰å­—æ®µéƒ½å·²å®šä¹?|
| **åç«¯API** | âš ï¸ åŸºæœ¬å¯ç”¨ | ç°æœ‰APIèƒ½è¯»å–ï¼Œä½†ç¼ºå°‘æ–°è¡¨API |
| **å‰ç«¯ç±»å‹** | âš ï¸ éœ€è¦æ›´æ–?| æœ‰æ—§å­—æ®µï¼Œç¼ºæ–°å­—æ®?|
| **å‰ç«¯ç»„ä»¶** | âš ï¸ åŸºæœ¬å¯ç”¨ | å°è°ƒæ•´å³å?|

**ç»“è®º**: 
- âœ?**æ•°æ®å¯ä»¥æ­£å¸¸æµè½¬**ï¼ˆåç«¯â†’å‰ç«¯ï¼?- âš ï¸ **å‰ç«¯ç±»å‹å®šä¹‰éœ€è¦æ›´æ–?*ä»¥åŒ¹é…æ–°å­—æ®µ
- â?**ç¼ºå°‘æ–°è¡¨çš„APIç«¯ç‚¹**ï¼ˆresident_contacts, resident_caregiversï¼?
---

## 1. Residents (ä½æˆ·)

### åç«¯Model (app/models/resident.py)
âœ?**å®Œå…¨æ”¯æŒæ–°å­—æ®?*:
```python
class ResidentBase(BaseModel):
    # âœ?HISé›†æˆå­—æ®µ
    HIS_resident_id: Optional[str]
    HIS_resident_bed_id: Optional[str]
    HIS_resident_status: Optional[str]
    
    resident_account: str
    first_name: Optional[str]
    last_name: str
    is_institutional: bool
    location_id: Optional[UUID]
    bed_id: Optional[UUID]
    admission_date: date
    status: str
    metadata: Optional[Dict]
    
    # âœ?å®¶åº­æ ‡ç­¾
    family_tag: Optional[str]
    family_member_account_1: Optional[str]
    can_view_status: bool

class Resident(ResidentBase):
    resident_id: UUID
    tenant_id: UUID
    anonymous_name: str  # âœ?åŒ¿åä»£ç§°
    
    # âœ?å“ˆå¸Œå­—æ®µï¼ˆä¸æš´éœ²ï¼?    phone_hash: Optional[bytes]
    email_hash: Optional[bytes]
```

### å‰ç«¯ç±»å‹ (frontend/src/types/index.ts)
âš ï¸ **éœ€è¦æ›´æ–?*:
```typescript
export interface Resident {
  resident_id: string
  tenant_id: string
  resident_account: string
  last_name: string
  is_institutional: boolean
  location_id?: string
  bed_id?: string
  admission_date?: string
  status: string
  can_view_status: boolean
  
  // â?æ—§å­—æ®µï¼ˆåº”è¯¥ç§»é™¤ï¼?  primary_contact_name?: string
  primary_contact_phone?: string
  primary_contact_relation?: string
  anonymous_display_name?: string  // â?åº”è¯¥æ˜?anonymous_name
  
  // â?ç¼ºå°‘æ–°å­—æ®?  // HIS_resident_id?: string
  // HIS_resident_bed_id?: string
  // HIS_resident_status?: string
  // anonymous_name: string  // æ­£ç¡®çš„å­—æ®µå
  // family_tag?: string
  // family_member_account_1?: string
  // first_name?: string
  // metadata?: any
  
  created_at: string
}
```

### å‰ç«¯ç»„ä»¶ (frontend/src/pages/Residents.tsx)
âš ï¸ **å°é—®é¢?*:
```typescript
// ç¬?8è¡?{resident.anonymous_display_name}  // â?åº”è¯¥æ˜?anonymous_name
```

### ç¤ºä¾‹æ•°æ® (init_sample_data.py)
âœ?**å®Œæ•´å­—æ®µ**:
```python
{
    "resident_id": "...",
    "tenant_id": "...",
    "HIS_resident_id": "HIS-R-2023-001",  # âœ?æ–°å¢
    "HIS_resident_bed_id": "HIS-BED-101-1",  # âœ?æ–°å¢
    "HIS_resident_status": "active",  # âœ?æ–°å¢
    "resident_account": "R001",
    "first_name": None,
    "last_name": "æ´»åŠ›è€äºº",
    "anonymous_name": "æ´»åŠ›è€äºº",  # âœ?æ­£ç¡®å­—æ®µå?    "is_institutional": True,
    "location_id": "...",
    "bed_id": "...",
    "admission_date": "...",
    "status": "active",
    "metadata": {...},
    "phone_hash": "...",  # âœ?æ–°å¢ï¼ˆå“ˆå¸Œï¼‰
    "email_hash": "...",  # âœ?æ–°å¢ï¼ˆå“ˆå¸Œï¼‰
    "family_tag": "FAMILY-WANG",  # âœ?æ–°å¢
    "family_member_account_1": None,  # âœ?æ–°å¢
    "can_view_status": True
}
```

### âœ?å…¼å®¹æ€?- **åç«¯è¯»å–**: âœ?å®Œå…¨å…¼å®¹ï¼ˆModelæ”¯æŒæ‰€æœ‰å­—æ®µï¼‰
- **å‰ç«¯æ˜¾ç¤º**: âš ï¸ éœ€ä¿®å¤ `anonymous_display_name` â†?`anonymous_name`
- **æ–°å­—æ®?*: âš ï¸ å‰ç«¯ç±»å‹éœ€è¦æ›´æ–°ï¼Œä½†ä¸å½±å“ç°æœ‰åŠŸèƒ½

---

## 2. Users (ç”¨æˆ·)

### åç«¯Model (app/models/user.py)
âœ?**å®Œå…¨æ”¯æŒæ–°å­—æ®?*:
```python
class UserBase(BaseModel):
    username: Optional[str]
    email: Optional[EmailStr]
    phone: Optional[str]
    role: str
    status: str
    
    # âœ?å‘Šè­¦é…ç½®å­—æ®µ
    alert_levels: Optional[List[str]]
    alert_channels: Optional[List[str]]
    alert_scope: Optional[str]
    
    # âœ?æ ‡ç­¾å­—æ®µ
    tags: Optional[Dict[str, Any]]

class User(UserBase):
    user_id: UUID
    tenant_id: UUID
    
    # âœ?å“ˆå¸Œå­—æ®µ
    email_hash: Optional[bytes]
    phone_hash: Optional[bytes]
    password_hash: Optional[bytes]
    pin_hash: Optional[bytes]
    
    last_login_at: Optional[datetime]
```

### å‰ç«¯ç±»å‹ (frontend/src/types/index.ts)
âš ï¸ **éœ€è¦æ›´æ–?*:
```typescript
export interface User {
  user_id: string
  tenant_id: string
  username: string
  full_name: string  // â?Modelä¸­æ²¡æœ‰è¿™ä¸ªå­—æ®?  email?: string
  phone?: string
  role: string
  department?: string  // â?åº”è¯¥åœ¨tagsä¸?  nurse_group_tag?: string  // â?åº”è¯¥åœ¨tagsä¸?  is_active: boolean
  
  // â?ç¼ºå°‘æ–°å­—æ®?  // status: string
  // alert_levels?: string[]
  // alert_channels?: string[]
  // alert_scope?: string
  // tags?: any
  // last_login_at?: string
  
  created_at: string
}
```

### ç¤ºä¾‹æ•°æ® (init_sample_data.py)
âœ?**å®Œæ•´å­—æ®µ**:
```python
{
    "user_id": "...",
    "tenant_id": "...",
    "username": "admin_user",
    "email": "admin@demo.com",
    "phone": "+86-138-0000-0001",
    "email_hash": "cd7e8bc9...",  # âœ?SHA-256
    "phone_hash": "f402b371...",  # âœ?SHA-256
    "password_hash": None,
    "pin_hash": None,
    "role": "Director",  # âœ?æ ‡å‡†è§’è‰²å?    "status": "active",
    "alert_levels": ["L1", "L2", "L3"],  # âœ?æ–°å¢
    "alert_channels": ["APP", "EMAIL"],  # âœ?æ–°å¢
    "alert_scope": "ALL",  # âœ?æ–°å¢
    "last_login_at": None,
    "tags": {  # âœ?æ–°å¢ï¼ˆæ ‡ç­¾åŒ–ï¼?        "department": "ç®¡ç†éƒ?,
        "permissions": ["all"]
    }
}
```

### âœ?å…¼å®¹æ€?- **åç«¯è¯»å–**: âœ?å®Œå…¨å…¼å®¹
- **å‰ç«¯æ˜¾ç¤º**: âš ï¸ ç¼ºå°‘æ–°å­—æ®µï¼Œä½†ä¸å½±å“ç°æœ‰åŠŸèƒ½

---

## 3. Devices (è®¾å¤‡)

### åç«¯Model (app/models/device.py)
âœ?**å®Œå…¨æ”¯æŒæ–°å­—æ®?*:
```python
class DeviceBase(BaseModel):
    device_name: str
    device_model: str
    device_type: str
    serial_number: Optional[str]
    uid: Optional[str]
    imei: Optional[str]  # âœ?æ–°å¢
    comm_mode: str
    firmware_version: str
    mcu_model: Optional[str]  # âœ?æ–°å¢
    
    location_id: Optional[UUID]
    bound_room_id: Optional[UUID]  # âœ?æ–°å¢
    bound_bed_id: Optional[UUID]  # âœ?æ–°å¢
    
    status: str
    installed: bool
    business_access: bool
    monitoring_enabled: bool
    installation_date_utc: datetime
    metadata: Optional[Dict]
```

### å‰ç«¯ç±»å‹ (frontend/src/types/index.ts)
âš ï¸ **åŸºæœ¬æ”¯æŒï¼Œç¼ºå°‘æ–°å­—æ®µ**:
```typescript
export interface Device {
  device_id: string
  tenant_id: string
  device_name: string
  device_model: string
  device_type: string
  serial_number?: string
  uid?: string
  comm_mode: string
  firmware_version?: string
  location_id?: string
  status: string
  installed: boolean
  business_access: boolean
  monitoring_enabled: boolean
  installation_date_utc?: string
  
  // â?ç¼ºå°‘æ–°å­—æ®?  // imei?: string
  // mcu_model?: string
  // bound_room_id?: string
  // bound_bed_id?: string
  // metadata?: any
  
  created_at: string
}
```

### ç¤ºä¾‹æ•°æ® (init_sample_data.py)
âœ?**å®Œæ•´å­—æ®µ**:
```python
{
    "device_id": "...",
    "tenant_id": "...",
    "device_name": "Aæ¥?å±‚é›·è¾?,
    "device_model": "WF-RADAR-60G-V2",
    "device_type": "Radar",
    "serial_number": "TDP20231001001",
    "uid": "TDP-RADAR-001",
    "imei": None,  # âœ?æ–°å¢
    "comm_mode": "WiFi",
    "firmware_version": "2.1.0",
    "mcu_model": "ESP32",  # âœ?æ–°å¢
    "location_id": "...",
    "bound_room_id": "...",  # âœ?æ–°å¢
    "bound_bed_id": "...",  # âœ?æ–°å¢
    "status": "online",
    "installed": True,
    "business_access": True,
    "monitoring_enabled": True,
    "installation_date_utc": "...",
    "metadata": {...}  # âœ?æ–°å¢
}
```

### âœ?å…¼å®¹æ€?- **åç«¯è¯»å–**: âœ?å®Œå…¨å…¼å®¹
- **å‰ç«¯æ˜¾ç¤º**: âœ?å¯ç”¨ï¼Œæ–°å­—æ®µä¸å½±å“ç°æœ‰åŠŸèƒ?
---

## 4. ResidentContacts (ä½æˆ·è”ç³»äº? âœ?æ–°è¡¨

### åç«¯Model (app/models/resident.py)
âœ?**å·²å®šä¹?*:
```python
class ResidentContactBase(BaseModel):
    slot: str  # A/B/C/D/E
    contact_resident_id: Optional[UUID]
    can_view_status: bool
    can_receive_alert: bool
    relationship: Optional[str]
    contact_first_name: Optional[str]
    contact_last_name: Optional[str]
    contact_phone: Optional[str]
    contact_email: Optional[EmailStr]
    contact_sms: bool
    is_active: bool

class ResidentContact(ResidentContactBase):
    contact_id: UUID
    tenant_id: UUID
    resident_id: UUID
    phone_hash: Optional[bytes]
    email_hash: Optional[bytes]
```

### åç«¯API
â?**ç¼ºå°‘**:
- æ²¡æœ‰ `app/api/v1/resident_contacts.py`
- æ— æ³•é€šè¿‡APIè®¿é—®è”ç³»äººæ•°æ?
### å‰ç«¯ç±»å‹
â?**ç¼ºå°‘**:
- `frontend/src/types/index.ts` ä¸­æ²¡æœ?ResidentContact æ¥å£

### ç¤ºä¾‹æ•°æ® (init_sample_data.py)
âœ?**å·²ç”Ÿæˆ?*: `app/data/resident_contacts.json` (2æ¡è®°å½?

### âš ï¸ å…¼å®¹æ€?- **æ•°æ®ç”Ÿæˆ**: âœ?æ­£å¸¸
- **åç«¯è¯»å–**: â?ç¼ºå°‘APIç«¯ç‚¹
- **å‰ç«¯æ˜¾ç¤º**: â?ç¼ºå°‘ç±»å‹å’Œç»„ä»?
---

## 5. ResidentCaregivers (æŠ¤ç†äººå‘˜å…³è”) âœ?æ–°è¡¨

### åç«¯Model (app/models/resident.py)
âœ?**å·²å®šä¹?*:
```python
class ResidentCaregiverBase(BaseModel):
    caregiver_id1: UUID
    caregiver_id2: Optional[UUID]
    caregiver_id3: Optional[UUID]
    caregiver_id4: Optional[UUID]
    caregiver_id5: Optional[UUID]
    caregivers_tags: Optional[Dict[str, Any]]

class ResidentCaregiver(ResidentCaregiverBase):
    id: UUID
    tenant_id: UUID
    resident_id: UUID
```

### åç«¯API
â?**ç¼ºå°‘**:
- æ²¡æœ‰ `app/api/v1/resident_caregivers.py`
- æ— æ³•é€šè¿‡APIè®¿é—®æŠ¤ç†å…³è”æ•°æ®

### å‰ç«¯ç±»å‹
â?**ç¼ºå°‘**:
- `frontend/src/types/index.ts` ä¸­æ²¡æœ?ResidentCaregiver æ¥å£

### ç¤ºä¾‹æ•°æ® (init_sample_data.py)
âœ?**å·²ç”Ÿæˆ?*: `app/data/resident_caregivers.json` (2æ¡è®°å½?

### âš ï¸ å…¼å®¹æ€?- **æ•°æ®ç”Ÿæˆ**: âœ?æ­£å¸¸
- **åç«¯è¯»å–**: â?ç¼ºå°‘APIç«¯ç‚¹
- **å‰ç«¯æ˜¾ç¤º**: â?ç¼ºå°‘ç±»å‹å’Œç»„ä»?
---

## 6. Tenants (ç§Ÿæˆ·)

### åç«¯Model
âœ?**æ”¯æŒmetadataæ‰©å±•**

### å‰ç«¯ç±»å‹
âš ï¸ **è¿˜åœ¨ç”¨è€å­—æ®?*:
```typescript
export interface Tenant {
  tenant_id: string
  tenant_name: string
  tenant_code: string  // â?åº”è¯¥åœ¨metadataä¸?  contact_email?: string  // â?åº”è¯¥åœ¨metadataä¸?  contact_phone?: string  // â?åº”è¯¥åœ¨metadataä¸?  address?: string  // â?åº”è¯¥åœ¨metadataä¸?  license_type: string  // â?åº”è¯¥åœ¨metadataä¸?  max_users: number  // â?åº”è¯¥åœ¨metadataä¸?  max_residents: number  // â?åº”è¯¥åœ¨metadataä¸?  features_enabled: string[]  // â?åº”è¯¥åœ¨metadataä¸?  is_active: boolean
  
  // â?ç¼ºå°‘æ ‡å‡†å­—æ®µ
  // domain?: string
  // status: string
  // metadata?: any
  
  created_at: string
}
```

### âœ?å…¼å®¹æ€?- **åç«¯è¯»å–**: âœ?metadataåŒ…å«æ‰€æœ‰å­—æ®?- **å‰ç«¯æ˜¾ç¤º**: âš ï¸ å¯ç”¨ï¼Œä½†å­—æ®µä½ç½®ä¸è§„èŒ?
---

## ğŸ“‹ éœ€è¦ä¿®å¤çš„é—®é¢˜æ¸…å•

### ä¼˜å…ˆçº?P0 (å½±å“åŠŸèƒ½)

1. **å‰ç«¯å­—æ®µåé”™è¯?*
   - æ–‡ä»¶: `frontend/src/pages/Residents.tsx:68`
   - é—®é¢˜: `anonymous_display_name` åº”è¯¥æ˜?`anonymous_name`
   - ä¿®å¤: 
     ```typescript
     // ä¿®æ”¹å‰?     {resident.anonymous_display_name}
     
     // ä¿®æ”¹å?     {resident.anonymous_name}
     ```

### ä¼˜å…ˆçº?P1 (å½±å“å®Œæ•´æ€?

2. **å‰ç«¯ç±»å‹å®šä¹‰è¿‡æ—¶**
   - æ–‡ä»¶: `frontend/src/types/index.ts`
   - é—®é¢˜: 
     - Resident: æœ‰æ—§å­—æ®µï¼Œç¼ºæ–°å­—æ®?     - User: ç¼ºå°‘å‘Šè­¦é…ç½®å’Œtagså­—æ®µ
     - Device: ç¼ºå°‘æ–°æŠ€æœ¯å­—æ®?   - ä¿®å¤: æ›´æ–°æ‰€æœ‰æ¥å£å®šä¹?
3. **ç¼ºå°‘æ–°è¡¨çš„APIç«¯ç‚¹**
   - éœ€è¦åˆ›å»?
     - `backend/app/api/v1/resident_contacts.py`
     - `backend/app/api/v1/resident_caregivers.py`
   - åŒ…å«: CRUDæ“ä½œï¼ˆGET/POST/PUT/DELETEï¼?
4. **ç¼ºå°‘æ–°è¡¨çš„å‰ç«¯æ”¯æŒ?*
   - éœ€è¦æ·»åŠ?
     - TypeScriptæ¥å£ï¼ˆResidentContact, ResidentCaregiverï¼?     - å¯é€‰ï¼šè”ç³»äººå’ŒæŠ¤ç†äººå‘˜ç®¡ç†é¡µé¢

### ä¼˜å…ˆçº?P2 (ä¼˜åŒ–)

5. **å‰ç«¯Tenantç±»å‹è§„èŒƒåŒ?*
   - å°†æ‰©å±•å­—æ®µç§»åˆ°metadataä¸?
---

## âœ?å½“å‰å¯ç”¨æ€§è¯„ä¼?
### ç°æœ‰åŠŸèƒ½

| åŠŸèƒ½ | åç«¯ | å‰ç«¯ | æ•°æ® | çŠ¶æ€?|
|------|------|------|------|------|
| **ä½æˆ·åˆ—è¡¨** | âœ?| âš ï¸ | âœ?| å¯ç”¨ï¼Œéœ€ä¿®å¤å­—æ®µå?|
| **ç”¨æˆ·åˆ—è¡¨** | âœ?| âš ï¸ | âœ?| å¯ç”¨ï¼Œç¼ºå°‘æ–°å­—æ®µæ˜¾ç¤º |
| **è®¾å¤‡åˆ—è¡¨** | âœ?| âœ?| âœ?| å®Œå…¨å¯ç”¨ |
| **å‘Šè­¦åˆ—è¡¨** | âœ?| âœ?| âœ?| å®Œå…¨å¯ç”¨ |
| **IoTæ•°æ®** | âœ?| âœ?| âœ?| å®Œå…¨å¯ç”¨ |
| **å¡ç‰‡ç®¡ç†** | âœ?| âœ?| âœ?| å®Œå…¨å¯ç”¨ |

### æ–°å¢åŠŸèƒ½

| åŠŸèƒ½ | åç«¯Model | åç«¯API | å‰ç«¯ç±»å‹ | å‰ç«¯ç»„ä»¶ | æ•°æ® | çŠ¶æ€?|
|------|----------|---------|---------|---------|------|------|
| **è”ç³»äººç®¡ç?* | âœ?| â?| â?| â?| âœ?| æ•°æ®æœ‰ï¼Œæ— æ³•è®¿é—® |
| **æŠ¤ç†å…³è”** | âœ?| â?| â?| â?| âœ?| æ•°æ®æœ‰ï¼Œæ— æ³•è®¿é—® |

---

## ğŸ¯ å»ºè®®è¡ŒåŠ¨

### ç«‹å³å¯åšï¼ˆå¿«é€Ÿä¿®å¤ï¼‰

1. **ä¿®å¤å‰ç«¯å­—æ®µå?* (5åˆ†é’Ÿ)
   ```bash
   # frontend/src/pages/Residents.tsx:68
   {resident.anonymous_name}  # æ”¹è¿™ä¸€å¤?   ```

2. **æµ‹è¯•ç°æœ‰åŠŸèƒ½** (10åˆ†é’Ÿ)
   - å¯åŠ¨åç«¯å’Œå‰ç«?   - éªŒè¯ä½æˆ·ã€è®¾å¤‡ã€å‘Šè­¦ç­‰é¡µé¢
   - ç¡®è®¤æ•°æ®æ­£å¸¸æ˜¾ç¤º

### å¯é€‰å¢å¼ºï¼ˆå¦‚éœ€å®Œæ•´åŠŸèƒ½ï¼?
3. **æ›´æ–°å‰ç«¯ç±»å‹** (30åˆ†é’Ÿ)
   - æ›´æ–° Resident, User, Device æ¥å£
   - æ·»åŠ  ResidentContact, ResidentCaregiver æ¥å£

4. **åˆ›å»ºæ–°è¡¨API** (2å°æ—¶)
   - åˆ›å»º resident_contacts.py
   - åˆ›å»º resident_caregivers.py
   - æµ‹è¯•CRUDæ“ä½œ

5. **å‰ç«¯æ”¯æŒ** (4å°æ—¶)
   - åˆ›å»ºè”ç³»äººç®¡ç†é¡µé?   - åˆ›å»ºæŠ¤ç†äººå‘˜ç®¡ç†é¡µé¢
   - åœ¨ä½æˆ·è¯¦æƒ…ä¸­æ˜¾ç¤ºå…³è”ä¿¡æ¯

---

## âœ?ç»“è®º

**å½“å‰çŠ¶æ€?*:
- âœ?**æ•°æ®å±?*: å®Œå…¨å¯¹é½æºå‚è€?- âœ?**åç«¯Models**: å®Œå…¨æ”¯æŒæ‰€æœ‰å­—æ®?- âš ï¸ **åç«¯API**: ç°æœ‰APIå¯ç”¨ï¼Œç¼ºå°‘æ–°è¡¨API
- âš ï¸ **å‰ç«¯**: åŸºæœ¬å¯ç”¨ï¼Œéœ€å°ä¿®å¤?
**å¯ç”¨æ€?*:
- âœ?**ç°æœ‰5ä¸ªé¡µé?*: å®Œå…¨å¯ç”¨ï¼ˆä¿®å¤?å¤„å­—æ®µååï¼‰
- â?**æ–°å¢2ä¸ªè¡¨**: æ•°æ®å·²ç”Ÿæˆï¼Œä½†æ— æ³•é€šè¿‡APIè®¿é—®

**å»ºè®®**:
1. **ç«‹å³**: ä¿®å¤ `anonymous_display_name` â†?`anonymous_name`
2. **çŸ­æœŸ**: æ›´æ–°å‰ç«¯ç±»å‹å®šä¹‰
3. **ä¸­æœŸ**: æ·»åŠ æ–°è¡¨çš„APIç«¯ç‚¹å’Œå‰ç«¯é¡µé?
---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-20 20:16  
**æ£€æŸ¥ç‰ˆæœ?*: init_sample_data.py v2.0 (Source-Aligned)
