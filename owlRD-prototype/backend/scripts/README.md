# Backend Scripts

**ç›®å½•**: `backend/scripts/`  
**ç”¨é€”**: è‡ªåŠ¨åŒ–éªŒè¯å’Œç»´æŠ¤è„šæœ¬

---

## ğŸ“‹ è„šæœ¬æ¸…å•

### 1. init_sample_data.py (1236è¡Œ) â­

**åŠŸèƒ½**: åˆå§‹åŒ–å®Œæ•´ç¤ºä¾‹æ•°æ®ï¼ˆ19/19è¡¨ï¼‰

**è¯¦ç»†åŠŸèƒ½**:
- ä¸¥æ ¼æŒ‰ç…§SQL Schemaç”Ÿæˆç¤ºä¾‹æ•°æ®
- è¦†ç›–æ‰€æœ‰19ä¸ªè¡¨ï¼ˆTenant/User/Resident/Device/IoT/Alertç­‰ï¼‰
- åŒ…å«åŠ å¯†PHIæ•°æ®ã€å‘Šè­¦ç­–ç•¥ã€å¡ç‰‡åŠŸèƒ½ç­‰
- ~100æ¡ç¤ºä¾‹è®°å½•ï¼Œå¯ç«‹å³ç”¨äºæ¼”ç¤ºå’Œæµ‹è¯•

**ç”¨æ³•**:
```bash
python scripts/init_sample_data.py
```

**è¾“å‡º**:
- åœ¨`app/data/`ç›®å½•ä¸‹åˆ›å»ºæ‰€æœ‰JSONæ•°æ®æ–‡ä»¶
- æ§åˆ¶å°æ˜¾ç¤ºè¯¦ç»†åˆå§‹åŒ–è¿›åº¦

---

### 2. validate_alignment.py (442è¡Œ)

**åŠŸèƒ½**: éªŒè¯åç«¯Pydantic Modelä¸SQLå®šä¹‰çš„å¯¹é½åº¦

**è¯¦ç»†åŠŸèƒ½**:
- ä»SQLæ–‡ä»¶æå–å­—æ®µå®šä¹‰ï¼ˆCREATE TABLEè§£æï¼‰
- ä»Pydantic Modelæå–å­—æ®µå®šä¹‰
- å¯¹æ¯”å­—æ®µåã€ç±»å‹ã€å¯ç©ºæ€§
- ç”Ÿæˆè¯¦ç»†å¯¹é½æŠ¥å‘Š

**ç”¨æ³•**:
```bash
python scripts/validate_alignment.py
```

**è¾“å‡º**:
- æ§åˆ¶å°ï¼šå¯¹é½åº¦ç™¾åˆ†æ¯”
- æ–‡ä»¶ï¼š`../../é¡¹ç›®è®°å½•/AUTO_å¯¹é½éªŒè¯æŠ¥å‘Š.md`

**ä¾èµ–**:
- Python 3.8+
- Pydantic Models in `app/models/`
- SQL files in `../../owdRD_github_clone_æºå‚è€ƒæ–‡ä»¶/owlRD/db/`

---

### 3. sync_checklist.py (420è¡Œ)

**åŠŸèƒ½**: æ™ºèƒ½åŒæ­¥æ£€æŸ¥æ¸…å•ï¼Œè‡ªåŠ¨æ›´æ–°å¯¹é½çŠ¶æ€

**è¯¦ç»†åŠŸèƒ½**:
- è¿è¡Œ`validate_alignment.py`è·å–éªŒè¯ç»“æœ
- æ™ºèƒ½è¿‡æ»¤åˆç†å·®å¼‚ï¼ˆä¸»é”®/å¤–é”®/æ—¶é—´æˆ³/Optionalç±»å‹ï¼‰
- è®¡ç®—è°ƒæ•´åçš„å¯¹é½åˆ†æ•°
- è‡ªåŠ¨æ›´æ–°æ£€æŸ¥æ¸…å•
- ç”Ÿæˆä¼˜å…ˆçº§åˆ†çº§çš„TODOæ¸…å•

**ç”¨æ³•**:
```bash
python scripts/sync_checklist.py
```

**è¾“å‡º**:
- `../../é¡¹ç›®è®°å½•/2-æºå‚è€ƒå¯¹ç…§/1-æ•°æ®åº“Schemaå¯¹ç…§/æ£€æŸ¥æ¸…å•.md` (æ›´æ–°)
- `../../é¡¹ç›®è®°å½•/AUTO_TODOä¿®å¤æ¸…å•.md`

**æ™ºèƒ½è¿‡æ»¤è§„åˆ™**:
```python
REASONABLE_EXTRA_FIELDS = {
    'tenant_id', 'created_at', 'updated_at',
    'device_id', 'user_id', 'resident_id',
    'location_id', 'room_id', 'bed_id',
    # ... ç­‰ä¸»é”®/å¤–é”®/æ—¶é—´æˆ³å­—æ®µ
}
```

---

### 4. validate_frontend_types.py (400è¡Œ)

**åŠŸèƒ½**: éªŒè¯å‰ç«¯TypeScriptç±»å‹ä¸åç«¯Pydantic Modelçš„å¯¹é½åº¦

**è¯¦ç»†åŠŸèƒ½**:
- è§£æTypeScriptæ¥å£å®šä¹‰ï¼ˆæ­£åˆ™åŒ¹é…ï¼‰
- ä»Python Modelæå–å­—æ®µå®šä¹‰
- æ™ºèƒ½ç±»å‹åŒ¹é…ï¼ˆstring â†” UUID/str/datetimeï¼‰
- å¯¹æ¯”å‰åç«¯ç±»å‹ä¸€è‡´æ€§
- ç”Ÿæˆè¯¦ç»†å¯¹é½æŠ¥å‘Š

**ç”¨æ³•**:
```bash
python scripts/validate_frontend_types.py
```

**è¾“å‡º**:
- æ§åˆ¶å°ï¼šå‰ç«¯ç±»å‹å¯¹é½åº¦
- æ–‡ä»¶ï¼š`../../é¡¹ç›®è®°å½•/AUTO_å‰ç«¯ç±»å‹å¯¹é½æŠ¥å‘Š.md`

**ç±»å‹æ˜ å°„è§„åˆ™**:
```python
TYPE_MAPPINGS = {
    'string': ['str', 'UUID', 'EmailStr', 'datetime', 'date'],
    'number': ['int', 'float', 'Decimal'],
    'boolean': ['bool'],
    'Record<string, any>': ['Dict', 'dict'],
}
```

---

## ğŸš€ å…¸å‹å·¥ä½œæµ

### ä¿®æ”¹ModelåéªŒè¯

```bash
# 1. ä¿®æ”¹app/models/*.py

# 2. éªŒè¯åç«¯å¯¹é½
python scripts/sync_checklist.py

# 3. æŸ¥çœ‹æŠ¥å‘Š
cat ../../é¡¹ç›®è®°å½•/AUTO_å¯¹é½éªŒè¯æŠ¥å‘Š.md
cat ../../é¡¹ç›®è®°å½•/AUTO_TODOä¿®å¤æ¸…å•.md

# 4. å¦‚æœæœ‰é—®é¢˜ï¼Œä¿®å¤Model

# 5. é‡æ–°éªŒè¯ç›´åˆ°100%å¯¹é½
```

### ä¿®æ”¹å‰ç«¯ç±»å‹åéªŒè¯

```bash
# 1. ä¿®æ”¹../../frontend/src/types/index.ts

# 2. éªŒè¯å‰ç«¯å¯¹é½
python scripts/validate_frontend_types.py

# 3. æŸ¥çœ‹æŠ¥å‘Š
cat ../../é¡¹ç›®è®°å½•/AUTO_å‰ç«¯ç±»å‹å¯¹é½æŠ¥å‘Š.md

# 4. ä¿®å¤ç±»å‹å®šä¹‰ç›´åˆ°å¯¹é½
```

### ä¸€é”®å…¨æ ˆéªŒè¯

```bash
# éªŒè¯æ‰€æœ‰
python scripts/sync_checklist.py && python scripts/validate_frontend_types.py

# æŸ¥çœ‹æ‰€æœ‰AUTOæŠ¥å‘Š
ls ../../é¡¹ç›®è®°å½•/AUTO_*.md
```

---

### 5. test_docs.py (62è¡Œ)

**åŠŸèƒ½**: æµ‹è¯•æ‰€æœ‰APIæ–‡æ¡£ç«¯ç‚¹

**è¯¦ç»†åŠŸèƒ½**:
- æµ‹è¯•8ä¸ªæ–‡æ¡£ç«¯ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œ
- åŒ…æ‹¬Swagger UIã€ReDocã€OpenAPIç­‰
- è‡ªåŠ¨æ£€æµ‹ç«¯ç‚¹å¯è®¿é—®æ€§
- ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

**ç”¨æ³•**:
```bash
python scripts/test_docs.py
```

**è¾“å‡º**:
- æ§åˆ¶å°ï¼šæ¯ä¸ªç«¯ç‚¹çš„æµ‹è¯•ç»“æœ
- æ¨èè®¿é—®åœ°å€

---

### 6. download_swagger_ui.py (2913 bytes)

**åŠŸèƒ½**: ä¸‹è½½æœ¬åœ°Swagger UIèµ„æº

**è¯¦ç»†åŠŸèƒ½**:
- ä»CDNä¸‹è½½Swagger UIé™æ€æ–‡ä»¶
- æ”¯æŒå®Œå…¨ç¦»çº¿ä½¿ç”¨
- è‡ªåŠ¨åˆ›å»ºæœ¬åœ°æ–‡æ¡£ç›®å½•

**ç”¨æ³•**:
```bash
python scripts/download_swagger_ui.py
```

**è¾“å‡º**:
- `static/swagger-ui/` ç›®å½•åŠæ–‡ä»¶
- å…è®¸`/docs-local`ç«¯ç‚¹å®Œå…¨ç¦»çº¿è®¿é—®

---

## ğŸ“Š å½“å‰å¯¹é½çŠ¶æ€

| ç»´åº¦ | å¯¹é½åº¦ | çŠ¶æ€ |
|------|--------|------|
| åç«¯Model â†” SQL | 100% | âœ… |
| å‰ç«¯Type â†” åç«¯Model | 100% | âœ… â­ |
| ç¤ºä¾‹æ•°æ®è¦†ç›– | 100% (19/19è¡¨) | âœ… â­ |
| å…¨æ ˆå¹³å‡ | **100%** | ğŸŠ |

**æ›´æ–°æ—¶é—´**: 2025-11-22

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æ¯æ¬¡ä¿®æ”¹Modelåè¿è¡ŒéªŒè¯**
   ```bash
   python scripts/sync_checklist.py
   ```

2. **æ¯æ¬¡ä¿®æ”¹types/index.tsåè¿è¡ŒéªŒè¯**
   ```bash
   python scripts/validate_frontend_types.py
   ```

3. **CIé›†æˆï¼ˆæœªæ¥ï¼‰**
   ```yaml
   # .github/workflows/validate.yml
   - name: Validate alignment
     run: |
       python backend/scripts/sync_checklist.py
       python backend/scripts/validate_frontend_types.py
   ```

4. **å®šæœŸæ£€æŸ¥AUTOæŠ¥å‘Š**
   - å‘ç°æŠ€æœ¯å€ºåŠ¡
   - ä¼˜å…ˆä¿®å¤æ ¸å¿ƒåŠŸèƒ½

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [è‡ªåŠ¨åŒ–éªŒè¯ä½“ç³»è¯´æ˜](../../é¡¹ç›®è®°å½•/2-æºå‚è€ƒå¯¹ç…§/2-è‡ªåŠ¨åŒ–éªŒè¯/README.md)
- [æ£€æŸ¥æ¸…å•](../../é¡¹ç›®è®°å½•/2-æºå‚è€ƒå¯¹ç…§/1-æ•°æ®åº“Schemaå¯¹ç…§/æ£€æŸ¥æ¸…å•.md)
- [æ–¹æ¡ˆBæ‰§è¡Œæ€»ç»“](../../é¡¹ç›®è®°å½•/3-åŠŸèƒ½è¯´æ˜/æ–¹æ¡ˆBæ‰§è¡Œæ€»ç»“.md)

---

**ç»´æŠ¤è€…**: Development Team  
**æœ€åæ›´æ–°**: 2025-11-22 15:10  
**è„šæœ¬æ•°é‡**: 6ä¸ªï¼ˆå·²å½’æ¡£2ä¸ªåºŸå¼ƒè„šæœ¬ï¼‰  
**æ€»ä»£ç é‡**: ~3100è¡Œ  
**åºŸå¼ƒè„šæœ¬**: create_sample_alert_policies.py, create_sample_phi.pyï¼ˆå·²å½’æ¡£ï¼‰
