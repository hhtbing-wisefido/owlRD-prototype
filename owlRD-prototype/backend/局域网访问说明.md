# 局域网访问配置说明

## 📡 服务器配置

服务器已配置为监听所有网络接口（`0.0.0.0:8000`），支持：
- ✅ 本地访问：`http://localhost:8000`
- ✅ 本机IP访问：`http://127.0.0.1:8000`
- ✅ 局域网IP访问：`http://your-ip:8000`

---

## 🔧 配置详情

### 1. 服务器绑定地址
```python
# app/config.py
host: str = "0.0.0.0"  # 监听所有网络接口
port: int = 8000
```

### 2. CORS配置
```python
# app/config.py
cors_origins = [
    "http://localhost:3000",
    "http://127.0.0.1:3000",
    "http://localhost:8000",
    "http://127.0.0.1:8000",
    "*"  # 允许所有源（开发环境）
]
```

---

## 🚀 启动服务器

### 方法1: 使用Python直接启动
```bash
cd owlRD-prototype/backend
python -m app.main
```

### 方法2: 使用uvicorn启动（推荐）
```bash
cd owlRD-prototype/backend
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 方法3: 使用提供的脚本
**Windows**:
```bash
./start_server.bat
```

**Linux/Mac**:
```bash
./start_server.sh
```

---

## 🌐 获取本机局域网IP

### Windows
```bash
ipconfig
# 查找 "IPv4 地址"
```

### Linux/Mac
```bash
ifconfig
# 或
ip addr show
```

### 示例输出
```
无线局域网适配器 WLAN:
   IPv4 地址 . . . . . . . . . . . . : 192.168.2.6
```

---

## 📱 局域网访问示例

您的电脑IP是 `192.168.2.6`

### API文档访问
- **Swagger UI**: `http://192.168.2.6:8000/docs`
- **ReDoc**: `http://192.168.2.6:8000/redoc`
- **健康检查**: `http://192.168.2.6:8000/`

### WebSocket连接
```javascript
const ws = new WebSocket('ws://192.168.2.6:8000/api/v1/realtime/ws/tenant-id');
```

### API调用
```javascript
fetch('http://192.168.2.6:8000/api/v1/tenants?limit=10')
  .then(res => res.json())
  .then(data => console.log(data));
```

---

## 🔥 防火墙配置

### Windows防火墙
1. 打开"Windows Defender 防火墙"
2. 点击"高级设置"
3. 选择"入站规则" > "新建规则"
4. 选择"端口" > "TCP" > 特定端口 "8000"
5. 选择"允许连接"
6. 应用到所有配置文件
7. 命名规则（如"owlRD API Server"）

### 快速命令（管理员权限）
```powershell
netsh advfirewall firewall add rule name="owlRD API Server" dir=in action=allow protocol=TCP localport=8000
```

### Linux防火墙（ufw）
```bash
sudo ufw allow 8000/tcp
sudo ufw reload
```

---

## 🧪 测试局域网访问

### 1. 启动服务器
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### 2. 获取本机IP
```bash
ipconfig  # Windows
ifconfig  # Linux/Mac
```

### 3. 在同一局域网的其他设备上测试

**浏览器访问**:
```
http://your-ip:8000/docs
```

**命令行测试**:
```bash
curl http://your-ip:8000/
```

****预期响应**:
```json
{
  "status": "healthy",
  "app": "owlRD Prototype",
  "version": "0.1.0",
  "message": "owlRD Backend API is running",
  "timestamp": "2023-03-01T12:00:00.000Z"
}
```

---

## ⚠️ 注意事项

### 开发环境
- ✅ CORS配置为允许所有源（`*`）
- ✅ 适合开发和测试
- ⚠️ 不适合生产环境

### 生产环境建议
修改 `app/config.py` 或设置环境变量：
```bash
# .env 文件
CORS_ORIGINS=["http://specific-ip:3000","http://another-ip:8080"]
DEBUG=False
```

### 安全建议
1. 生产环境应配置具体的允许IP列表
2. 启用HTTPS（使用反向代理如Nginx）
3. 添加认证和权限控制
4. 配置防火墙只允许特定IP访问

---

## 🔧 环境变量配置

创建 `.env` 文件（可选）:
```bash
# .env
APP_NAME=owlRD Prototype
DEBUG=True
HOST=0.0.0.0
PORT=8000
CORS_ORIGINS=["*"]
LOG_LEVEL=INFO
```

---

## 📞 常见问题

### Q1: 无法通过局域网IP访问
**A**: 检查防火墙设置，确保端口8000已开放

### Q2: CORS错误
**A**: 已配置允许所有源，如仍有问题请检查浏览器控制台详细错误

### Q3: WebSocket连接失败
**A**: 确保使用`ws://`而非`wss://`（除非配置了SSL）

### Q4: 如何查看服务器日志
**A**: 日志保存在 `logs/app_YYYY-MM-DD.log`

---

## 📊 访问地址汇总

| 访问方式 | 地址格式 | 示例 |
|---------|---------|------|
| 本地访问 | http://localhost:8000 | http://localhost:8000/docs |
| 本机IP | http://127.0.0.1:8000 | http://127.0.0.1:8000/docs |
| 局域网IP | http://your-ip:8000 | http://192.168.2.6:8000/docs |
| WebSocket | ws://your-ip:8000/api/v1/realtime/ws/{tenant_id} | ws://192.168.2.6:8000/api/v1/realtime/ws/test |

---

**配置完成！现在可以在局域网内任何设备访问API了！** 🎉
